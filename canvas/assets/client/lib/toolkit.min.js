/*
# toolkit.js

*README* coming soon.

Author Robin Saxifrage | https://github.com/robinsax/toolkit.js

Licensed under Apache 2.0

*/
function createToolkit(){if(Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector),!t)var t=function(){};var e=function(t){return new i(t)};function n(t){return e.config.dataPrefix+"-"+t}function i(n){var r=this;this.origin=e.varg(arguments,1,null),this.set=function(){switch(n instanceof i&&(n=n.set.splice()),e.typeCheck(n,[Element,t,Array,"string"])){case 0:case 1:return[n];case 2:for(var r=0;r<n.length;r++){var s=n[r];s instanceof i&&(n[r]=s.set[0])}return n;case 3:return e.config.rootElement.querySelectorAll(n)}}(),this.length=this.set.length,this.empty=0==this.length,this.debug=function(){return console.log(e.varg(arguments,0,"Debug")+":",this),this},this.back=function(){if(null==this.origin)throw"Illegal back()";return this.origin},this.reverse=function(){var t=this.set.slice();return t.reverse(),new i(t,this)},this.ith=function(t){if(t<0||t>=this.length)throw"Out of bounds: "+t;return e.varg(arguments,1,!0)?new i(this.set[t],this):this.set[t]},this.reduce=function(t){var n;switch(e.typeCheck(t,["string","function"])){case 0:n=this.comprehension(function(e){if(e.is(t))return e});break;case 1:n=this.comprehension(t)}return new i(n,this)},this.extend=function(t){switch(e.typeCheck(t,[i,Array])){case 0:t=t.set;case 1:return t=e.comprehension(t,function(t){return t instanceof i?t.set[0]:t}),new i(this.set.concat(t),this)}},this.parents=function(){if(1==arguments.length&&"boolean"==typeof arguments[0])return this.parents("*",arguments[0]);var t,n=e.varg(arguments,0,null),r=e.typeCheck(n,[null,"string","function"]),s=e.varg(arguments,1,!0);function o(t,e){return null==n||1==r&&t.matches(n)||2==r&&n(t,e)}return e.typeCheck(s,["boolean"]),s?(t=[],this.iter(function(e,n){for(var i=e.parentNode;i!==document;)o(i,n)&&t.push(i),i=i.parentNode},!1)):t=this.comprehension(function(t,e){if(o(t.parent,e))return t.parent},!1),new i(t,this)},this.children=function(){if(1==arguments.length&&"boolean"==typeof arguments[0])return this.children("*",arguments[0]);var t=e.varg(arguments,0,"*"),n=[];return e.varg(arguments,1,!0)?this.iter(function(i,r){e.iter(i.querySelectorAll(e.resolve(t,i,r)),function(t,e){-1==n.indexOf(t)&&n.push(t)})},!1):this.iter(function(i,r){e.iter(i.children,function(s,o){(null==t||s.matches(e.resolve(t,i,r)))&&n.push(s)})},!1),new i(n,this)},this.copy=function(){return new i(this.set[0].cloneNode(!0),this)},this.equals=function(t){switch(e.typeCheck(t,[Element,Array,i])){case 0:return 1==r.length&&r.set[0]==t;case 2:t=t.set;case 1:var n=!1;return iter(t,function(t){if(-1==r.set.indexOf(t))return n=!0,!1}),iter(r.set,function(e){if(-1==t.indexOf(e))return n=!0,!1}),!n&&r.length==t.length}},this.iter=function(t){for(var n=e.varg(arguments,1,!0),r=0;r<this.set.length;r++){var s=this.set[r];if(n&&(s=new i(s,this)),!1===t(s,r))break}return this},this.comprehension=function(t){for(var n=e.varg(arguments,1,!0),r=[],s=0;s<this.set.length;s++){var o=this.set[s];n&&(o=new i(o,this));var u=t(o,s);void 0!==u&&r.push(u)}return r},this.is=function(t){e.typeCheck(t,["string","function"]);for(var n=0;n<this.length;n++){var i=this.set[n];if(!i.matches(e.resolve(t,i,n)))return!1}return!0},this.classes=function(){var t=[];return this.iter(function(e){for(var n=e.className.split(/\s+/),i=0;i<n.length;i++){var r=n[i];-1==t.indexOf(r)&&t.push(r)}},!1),t},this.value=function(){if(arguments.length>0){arguments[0];return this.iter(function(t,e){t.value=v},!1),this}return"checkbox"==this.set[0].type?this.set[0].checked:this.set[0].value},this.attr=function(t){switch(e.typeCheck(t,["string","object"])){case 0:if(!(arguments.length>1))return this.set[0].hasAttribute(t)?this.set[0].getAttribute(t):null;var n=t,i=arguments[1];switch(e.typeCheck(i,[null,"string","function"])){case 0:this.iter(function(t,e){t.removeAttribute(n,null)},!1);break;default:this.iter(function(t,r){t.setAttribute(e.resolve(n,t,r),e.resolve(i,t,r))},!1)}break;case 1:this.iter(function(n,i){for(var r in t)n.setAttribute(r,e.resolve(t[r],n,i))},!1)}return this},this.css=function(t){function n(t,n){t=t.replace(/-([a-z])/g,function(t){return t[1].toUpperCase()}),r.iter(function(i,r){var s=e.resolve(n,i,r);"number"==typeof s&&(s+="px"),i.style[t]=s},!1)}switch(e.typeCheck(t,["string","object"])){case 0:if(!(arguments.length>1))return window.getComputedStyle(this.set[0]).getPropertyValue(t);n(t,arguments[1]);break;case 1:for(var i in t)n(i,t[i])}return this},this.on=function(t){function n(t,n){r.iter(function(r,s){e.prop(r,"__listeners__")||(r.__listeners__=[]);var o={event:e.resolve(t,r,s),func:function(t){n(new i(r),t,s)}};r.__listeners__.push(o),r.addEventListener(o.event,o.func)},!1)}switch(e.typeCheck(t,["function","string","object"])){case 0:case 1:n(t,arguments[1]);break;case 2:for(var s in t)n(s,t[s])}return this},this.off=function(t){return this.iter(function(n){var i=e.prop(n,"__listeners__",[]),r=[];e.iter(i,function(e,i){e.event==t&&(n.removeEventListener(e.event,e.func),r.push(i))}),e.iter(r,function(t){i=i.splice(t,1)})},!1),this},this.classify=function(t){function n(t,i,s){var o="."+t;"toggle"==i&&(f=function(t,e){return!t.is(o)}),r.iter(function(r,u){var c=e.resolve(i,r,u),a=r.classes();c?r.is(o)||(a.push(t),r.set[0].className=a.join(" ").trim()):r.is(o)&&(a.splice(a.indexOf(t),1),r.set[0].className=a.join(" ").trim());var f=e.resolve(s,r,u);f>=0&&e.defer(function(){n(t,!c,-1)},f)})}switch(e.typeCheck(t,["string","object"])){case 0:var i=e.varg.on(arguments);n(t,i(1,!0),i(2,-1));break;case 1:e.iter(t,n)}return this},this.remove=function(){return this.iter(function(t){null!=t.parentNode&&t.parentNode.removeChild(t)},!1),this},this.append=function(t){switch(e.typeCheck(t,[Array,i,Element])){case 0:var n=[];return e.iter(t,function(t){r.append(t).iter(function(t){n.push(t.set[0])})}),new i(n,this);case 1:return t.iter(function(n){n.remove(),r.set[0].appendChild(n.set[0]),e.config.callbacks.preInsert(t)}),t.origin=this,t;case 2:return r.set[0].appendChild(t),e.config.callbacks.preInsert(t),new i(t,this)}},this.prepend=function(t){switch(typeCheck(t,[Array,i,Element])){case 0:var e=[];return t=t.splice(0).reverse(),iter(t,function(t){r.prepend(t).iter(function(t){e.push(t.set[0])})}),new i(e,this);case 1:return t.reverse().iter(function(t){t.remove(),r.set[0].insertBefore(t.set[0],r.set[0].firstChild),config.config.callbacks.preInsert(t)}),t.origin=this,t;case 2:return r.set[0].insertBefore(t,this.set[0].firstChild),config.callbacks.preInsert(t),new i(t,this)}},this.tag=function(){return this.set[0].tagName},this.next=function(){var t=this.set[0].nextElementSibling;return null==t&&(t=[]),new i(t,this)},this.prev=function(){var t=this.set[0].previousElementSibling;return null==t&&(t=[]),new i(t,this)},this.html=function(){if(arguments.length>0){var t=arguments[0];return this.iter(function(n,i){n.innerHTML=e.resolve(t,n,i)},!1),this}return this.set[0].innerHTML},this.text=function(){if(arguments.length>0){var t=arguments[0];return this.iter(function(n,i){n.textContent=e.resolve(t,n,i)},!1),this}return this.set[0].textContent},this.select=function(){return this.set[0].select(),this},this.offset=function(){for(var t=0,e=0,n=this.set[0];null!=n;)t+=n.offsetLeft,e+=n.offsetTop,n=n.offsetParent;return{x:t,y:e}},this.size=function(){var t=this.set[0],n=t.getBoundingClientRect(),i={width:n.width,height:n.height};if(e.varg(arguments,0,!1)){var r=window.getComputedStyle(t,null);i.width+=r.getPropertyValue("margin-left")+r.getPropertyValue("margin-right"),i.height+=r.getPropertyValue("margin-top")+r.getPropertyValue("margin-bottom"),"border-box"==r.getPropertyValue("box-sizing")&&(i.width+=r.getPropertyValue("padding-left")+r.getPropertyValue("padding-right"),i.height+=r.getPropertyValue("padding-top")+r.getPropertyValue("padding-bottom"))}return i},this.bind=function(t,n){return e.binding(this,t,n)}}function r(t,n,i){if(!e.prop(n,i))throw"No such property: "+i;var r,s,o;if(e.prop(n,"__bindings__")||(n.__bindings__={}),e.prop(n.__bindings__,i)?n.__bindings__[i].push(this):(n.__bindings__[i]=[this],Object.defineProperty(n,i,(r=n[i],s=n.__bindings__[i],o=r,{get:function(){return o},set:function(t){e.iter(s,function(e){e.apply(t)}),o=t}}))),n[i]instanceof Array){var u=n[i];function c(){e.iter(u,function(t,e){var r;Object.defineProperty(u,e+"",(r=t,{get:function(){return r},set:function(t){r=t,n[i]=u},configurable:!0}))})}e.iter(["push","pop","splice"],function(t){var e=u[t];u[t]=function(){var t=e.apply(u,arguments);return c(),n[i]=u,t}}),c()}var a=e.config.binding.defaultReset,f=e.config.binding.defaultPlacement,h=e.config.binding.defaultTransform;this.placement=function(t){return f=t,this},this.transform=function(t){return h=t,this},this.reset=function(t){return a=t,this},this.apply=function(e){a(e,t),f(h(e),t)},this.begin=function(){return f(h(n[i]),t),t}}e.fn={identity:function(t){return t},eatCall:function(){}},e.config={debug:!1,rootElement:document,dataPrefix:"tk",callbacks:{preInsert:e.fn.eatCall,preXHR:e.fn.eatCall},requests:{defaultSuccess:e.fn.eatCall,defaultFailure:e.fn.eatCall,defaultResponseParser:e.fn.identity,defaultMimetype:"text/plain"},binding:{defaultPlacement:function(t,e){e.html(t)},defaultTransform:function(t,e){return t},defaultReset:e.fn.eatCall}},arguments.length>0&&function t(e,n){for(var i in n)"object"==typeof e[i]?t(e[i],n[i]):e[i]=n[i]}(e.config,arguments[0]),e.config.attrNames={bind:n("bind"),onto:n("onto"),viewFn:n("view-fn"),src:n("src"),callback:n("callback"),event:n("event"),on:n("on"),template:n("template")},e.debug=function(){e.config.debug&&console.log.apply(null,arguments)},e.millis=function(){return(new Date).getTime()},e.iter=function(t,n){switch(e.typeCheck(t,[NodeList,Array,"object"])){case 0:case 1:for(var i=0;i<t.length&&!1!==n(t[i],i);i++);return;case 2:for(var r in t)if(!1===n(r,t[r]))break;return}},e.comprehension=function(t,n){e.typeCheck(t,[Array]);for(var i=[],r=0;r<t.length;r++){var s=n(t[r],r);void 0!==s&&i.push(s)}return i},e.prop=function(t,e){var n=t.hasOwnProperty(e);return 2==arguments.length?n:n?t[e]:arguments[2]},e.prop.on=function(t){return function(n){return 2==arguments.length?e.prop(t,n,arguments[1]):e.prop(t,n)}},e.defer=function(t,e){setTimeout(t,e)},e.repeat=function(t,n){var i=setInterval(t,n);return e.varg(arguments,2,!1)&&t(),{stop:function(){clearInterval(i)}}},e.range=function(t){var e=0,n=t;arguments.length>1&&(e=t,n=arguments[1]);for(var i=[],r=e;r<n;r++)i.push(r);return i},e.functionName=function(t){var e=/^function\s+([\w\$]+)\s*\(/.exec(t.toString());return e?e[1]:"<anonymous function>"},e.extends=function(t,e){e.apply(t)},e.varg=function(t,e,n){return t.length>e?arguments.length>3&&arguments[3]&&null==t[e]?n:t[e]:n},e.varg.on=function(t){return function(n,i){return e.varg(t,n,i,e.varg(arguments,2,!1))}},e.typeCheck=function(t,n){n instanceof Array||(n=[n]);for(var i=-1,r=0;r<n.length;r++){var s=n[r];if(null==s){if(null==t){i=r;break}}else{if(typeof t==s){i=r;break}try{if(t instanceof s){i=r;break}}catch(t){}}}if(-1==i){var o=[];for(r=0;r<n.length;r++){var u=n[r];null==u?o.push("null"):"string"==typeof u?o.push(u):o.push(e.functionName(u))}throw"Incorrect parameter type "+typeof t+" (expected one of "+o.join(", ")+")"}return i},e.resolve=function(t){if("function"==typeof t){var n=[].slice.call(arguments);if(n.splice(0,1),e.varg(arguments,1,!0))for(var r=0;r<n.length;r++)n[r]instanceof Element&&(n[r]=new i(n[r]));return t.apply(null,n)}return t},e.tag=function(t){return new i(document.createElement(t))},e.binding=function(t,e,n){return new r(t,e,n)},e.binding.on=function(t){return function(n,i){e.binding(n,t,i)}},e.request=function(t,n){return new function(t,n){var i=e.config.requests.defaultSuccess,r=e.config.requests.defaultFailure,s=e.config.requests.defaultMimetype,o=e.config.requests.defaultResponseParser,u=null,c=null,a=null;this.success=function(t){return i=t,this},this.failure=function(t){return r=t,this},this.responseParser=function(t){return o=t,this},this.query=function(t){return a=t,this},this.json=function(t){return mimeType="application/json",u=t,c=JSON.stringify(t),this},this.send=function(){var f=new XMLHttpRequest;null!=a&&(n+="?"+e.comprehension(a,function(t,e){return t+"="+encodeURIComponent(e)}).join("&")),f.onreadystatechange=function(){if(4==this.readyState){var s=this.status,u=o(this.responseText);e.debug("Received ("+t+": "+n+"): "+s,u),(s<400?i:r)(u,s)}},f.open(t,n,!0),null!=c?f.setRequestHeader("Content-Type",s):c="",e.config.callbacks.preXHR(f,t,n,c),e.debug("Sent ("+t+": "+n+")",u),f.send(c)}}(t,n)};var s=[];function o(){e.iter(s,function(t){t()})}return e.init=function(t){return s.push(t),e},e.ToolkitSelection=i,e.Binding=r,/complete|loaded|interactive/.test(document.readyState)?o():window&&window.addEventListener("DOMContentLoaded",o),e}