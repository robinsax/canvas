/*
	toolkit.js

	Author: Robin Saxifrage
	License: Apache 2.0
*/
"use strict";function createToolkit(){var t=new Object,n=function(t){return new i(t)};function e(){var t,e;n.iter(n.initFunctions,n.fn.call),t=n("html"),e=t.extend(t.children()),n.iter(n.inspectionFunctions,function(t){t(e)})}function i(t){var e=this;this.backChain=n.varg(arguments,1,null),this.set=function(){switch(t instanceof i&&(t=t.set.splice()),n.typeCheck(t,Element,Window,NodeList,Array,"string")){case 0:case 1:return[t];case 2:case 3:for(var e=[],r=0;r<t.length;r++){var s=t[r];s instanceof i?e=e.concat(s.set):e.push(s)}return e;case 4:return n.config.documentRoot.querySelectorAll(t)}}(),this.set=[].slice.call(this.set),this.length=this.set.length,this.empty=0==this.length,this.back=function(){if(null==this.backChain)throw"Illegal back()";return this.backChain},this.ith=function(t){if(t<0||t>=this.length)throw"Out of bounds: "+t;return n.varg(arguments,1,!0)?new i(this.set[t],this):this.set[t]},this.first=function(){return this.ith(0)},this.reversed=function(){var t=this.set.slice();return t.reverse(),new i(t,this)},this.reduce=function(t){var e;switch(n.typeCheck(t,"string","function")){case 0:e=this.comprehension(function(n){if(n.is(t))return n});break;case 1:e=this.comprehension(t)}return new i(e,this)},this.extend=function(t){switch(n.typeCheck(t,i,Array)){case 0:return new i(this.set.concat(t.set),this);case 1:for(var e=[],r=0;r<t.length;r++){var s=t[r];s instanceof i?e=e.concat(s.set):e.push(s)}return new i(this.set.concat(t),this)}},this.parents=function(){if(1==arguments.length&&"boolean"==typeof arguments[0])return this.parents("*",arguments[0]);var t=n.varg.on(arguments),e=t(0,"*"),r=t(1,!0),s=n.typeCheck(e,"string","function");n.typeCheck(r,"boolean");var o=[];return this.iter(function(t,i){for(var a,c,h=t.parentNode;h!=n.config.documentRoot;){if(a=h,c=i,(0==s&&a.matches(e)||1==s&&e(a,c))&&o.push(h),!r)return;h=h.parentNode}},!1),new i(o,this)},this.children=function(){if(1==arguments.length&&"boolean"==typeof arguments[0])return this.children("*",arguments[0]);var t=n.varg.on(arguments),e=t(0,"*"),r=t(1,!0),s=n.typeCheck(e,"string","function");n.typeCheck(r,"boolean");var o=[];return this.iter(function(t,a){var c=function(t,o){if(0==s)return r?t.querySelectorAll(e):t.children;var a=r?t.querySelectorAll("*"):t.children;return n.comprehension(a,function(t){if(e(new i(t),o))return t})}(t,a);for(a=0;a<c.length;a++)o.push(c[a])},!1),new i(o,this)},this.copy=function(){return new i(this.set[0].cloneNode(!0),this)},this.equals=function(t){switch(n.typeCheck(t,Element,Array,i)){case 0:return 1==e.length&&e.set[0]==t;case 2:t=t.set;case 1:var r=!1;return iter(t,function(t){if(-1==e.set.indexOf(t))return r=!0,!1}),iter(e.set,function(n){if(-1==t.indexOf(n))return r=!0,!1}),!r&&e.length==t.length}},this.iter=function(t){for(var e=n.varg(arguments,1,!0),r=0;r<this.set.length;r++){var s=this.set[r];if(e&&(s=new i(s,this)),!1===t(s,r))break}return this},this.comprehension=function(t){for(var e=n.varg(arguments,1,!0),r=[],s=0;s<this.set.length;s++){var o=this.set[s];e&&(o=new i(o,this));var a=t(o,s);void 0!==a&&r.push(a)}return r},this.is=function(t){for(var e=n.typeCheck(t,"string","function"),i=0;i<this.length;i++){var r=this.set[i];if(0==e){if(!r.matches(t))return!1}else if(!t(new ToolkitInstance(r),i))return!1}return!0},this.classes=function(){var t=[];return this.iter(function(n){for(var e=n.className.split(/\s+/),i=0;i<e.length;i++){var r=e[i];-1==t.indexOf(r)&&t.push(r)}},!1),t},this.value=function(){if(arguments.length>0){var t=arguments[0];return this.iter(function(n){"select"==n.tag().toLowerCase()?n.children("option").attr("selected",function(n){return n.attr("value")==t}):n.ith(0,!1).value=t}),this}if("checkbox"==this.set[0].type)return this.set[0].checked;var n=this.set[0].value;return void 0===n||0==n.length?null:"number"==this.set[0].getAttribute("type")?+n:n},this.attr=function(t){switch(n.typeCheck(t,"string","object")){case 0:if(!(arguments.length>1))return this.set[0].hasAttribute(t)?this.set[0].getAttribute(t):null;var e=t,r=arguments[1];switch(n.typeCheck(r,null,"string","function")){case 0:this.iter(function(t,n){t.removeAttribute(e,null)},!1);break;default:this.iter(function(t,s){t.setAttribute(e,n.resolve(r,new i(t),s))},!1)}break;case 1:this.iter(function(e,i){for(var r in t)e.setAttribute(r,n.resolve(t[r],e,i))},!1)}return this},this.css=function(t){function i(t,i){t=t.replace(/-([a-z])/g,function(t){return t[1].toUpperCase()}),e.iter(function(e,r){var s=n.resolve(i,e,r);"number"==typeof s&&(s+="px"),e.style[t]=s},!1)}switch(n.typeCheck(t,"string","object")){case 0:if(!(arguments.length>1))return window.getComputedStyle(this.set[0]).getPropertyValue(t);i(t,arguments[1]);break;case 1:for(var r in t)i(r,t[r])}return this},this.on=function(t){function r(t,r){e.iter(function(e,s){n.prop(e,"__listeners__")||(e.__listeners__=[]);var o={event:n.resolve(t,e,s),func:function(t){r(new i(e),t,s)}};e.__listeners__.push(o),e.addEventListener(o.event,o.func)},!1)}switch(n.typeCheck(t,"string","object")){case 0:r(t,arguments[1]);break;case 1:for(var s in t)r(s,t[s])}return this},this.off=function(t){return this.iter(function(e){var i=n.prop(e,"__listeners__",[]),r=[];n.iter(i,function(n,i){n.event==t&&(e.removeEventListener(n.event,n.func),r.push(i))}),n.iter(r,function(t){i=i.splice(t,1)})},!1),this},this.classify=function(t){function i(t,r,s){var o="."+t;"toggle"==r&&(r=function(t,n){return!t.is(o)}),e.iter(function(e,a){var c=n.resolve(r,e,a),h=e.classes();c?e.is(o)||(h.push(t),e.set[0].className=h.join(" ").trim()):e.is(o)&&(h.splice(h.indexOf(t),1),e.set[0].className=h.join(" ").trim());var u=n.resolve(s,e,a);u>=0&&n.timeout(function(){i(t,!c,-1)},u)})}switch(n.typeCheck(t,"string","object")){case 0:var r=n.varg.on(arguments);i(t,r(1,!0),r(2,-1));break;case 1:n.iter(t,i)}return this},this.remove=function(){return this.iter(function(t){null!=t.parentNode&&t.parentNode.removeChild(t)},!1),this},this.append=function(t){switch(n.typeCheck(t,Array,i,"string",Element)){case 0:var r=[];return n.iter(t,function(t,n){t instanceof i?(t.remove(),r=r.concat(t.set)):(t.parentNode.removeChild(t),r.push(t))}),n.iter(r,function(t){var r=new i(t,this);n.iter(n.inspectionFunctions,function(t){t(r)}),e.set[0].appendChild(t)}),new i(r,this);case 1:return t.iter(function(t){t.remove(),e.set[0].appendChild(t.set[0]),n.iter(n.inspectionFunctions,function(n){n(t)})}),t.backChain=this,t;case 2:t=document.createElement(t);case 3:e.set[0].appendChild(t);var s=new i(t,this);return n.iter(n.inspectionFunctions,function(t){t(s)}),s}},this.prepend=function(t){switch(n.typeCheck(t,Array,i,Element)){case 0:var r=[];return n.iter(arg,function(t,n){t instanceof i?(t.remove(),r=r.concat(t.set)):(t.parentNode.removeChild(t),r.push(t))}),n.iter(r,function(t){var r=new i(t,this);n.iter(n.inspectionFunctions,function(t){t(r)}),e.set[0].insertBefore(t,e.set[0].firstChild)}),new i(r,this);case 1:return t.reversed().iter(function(t){t.remove(),e.set[0].insertBefore(t.set[0],e.set[0].firstChild),n.iter(n.inspectionFunctions,function(n){n(t)})}),t.backChain=this,t;case 2:e.set[0].insertBefore(t,e.set[0].firstChild);var s=new i(t,this);return n.iter(n.inspectionFunctions,function(t){t(s)}),s}},this.tag=function(){return this.set[0].tagName},this.next=function(){var t=this.set[0].nextElementSibling;return null==t&&(t=[]),new i(t,this)},this.prev=function(){var t=this.set[0].previousElementSibling;return null==t&&(t=[]),new i(t,this)},this.html=function(){if(arguments.length>0){var t=arguments[0];return this.iter(function(e,r){e.innerHTML=n.resolve(t,new i(e),r)},!1),this}return this.set[0].innerHTML},this.text=function(){if(arguments.length>0){var t=arguments[0];return this.iter(function(e,r){e.textContent=n.resolve(t,new i(e),r)},!1),this}return this.set[0].textContent},this.select=function(){return this.set[0].select(),this},this.offset=function(){for(var t=0,n=0,e=this.set[0];null!=e;)t+=e.offsetLeft,n+=e.offsetTop,e=e.offsetParent;return{x:t,y:n}},this.size=function(){var t=this.set[0],e=t.getBoundingClientRect(),i={width:e.width,height:e.height};if(n.varg(arguments,0,!1)){var r=window.getComputedStyle(t,null);i.width+=r.getPropertyValue("margin-left")+r.getPropertyValue("margin-right"),i.height+=r.getPropertyValue("margin-top")+r.getPropertyValue("margin-bottom"),"border-box"==r.getPropertyValue("box-sizing")&&(i.width+=r.getPropertyValue("padding-left")+r.getPropertyValue("padding-right"),i.height+=r.getPropertyValue("padding-top")+r.getPropertyValue("padding-bottom"))}return i},this.snap=function(t){var e=[].slice.call(arguments);return e.splice(0,1),n.snap.apply(n,[t,this].concat(e))},this.binding=function(){return n.binding.apply(n,arguments).onto(this)},this.binding.snap=function(){var t=[].slice.call(arguments);return n.binding.snap.apply(n,[e].concat(t))}}function r(t,e){var i=this;this.source=n.varg(arguments,2,null),this.host=t,this.property=e,this.fns={callback:n.fn.eatCall},this._processChange=function(t){i.fns.callback(t)},this._createListener=function(t,e){var i=e;return{get:function(){return i},set:function(e){n.iter(t,function(t){t(e)}),i=e}}},this.changed=function(t){return this.fns.callback=t,this},this.onto=function(t){return new function(t,e){var i=this;this.parent=t,this.element=e,this.started=!1,this.fns={reset:n.fn.eatCall,transform:n.fn.identity,placement:function(t,n){n.html(t)}},this._applyChange=function(t){i.started||(i.fns.reset(t,i.element),i.started=!0),i.fns.placement(i.fns.transform(t),i.element)},this.reset=function(t){return this.fns.reset=t,this},this.transform=function(t){return this.fns.transform=t,this},this.placement=function(t){return this.fns.placement=t,this},this.and=function(){return t.changed(this._applyChange),this.parent.and()},this.begin=function(){return this.parent.changed(this._applyChange),this.parent.begin(),this.element}}(this,t)},this.and=function(){return new r(this.host,this.property,this)},this.begin=function(){if(null!=this.source)this.source.begin();else if(n.prop(this.host,"__bindings__")||(this.host.__bindings__={}),!n.prop(this.host.__bindings__,e)){this.host.__bindings__[e]=[];var t=this._createListener(this.host.__bindings__[e],this.host[e]);Object.defineProperty(this.host,e,t)}return this.host.__bindings__[e].push(this._processChange),this._processChange(this.host[e]),this.element}}function s(t){var e=this;this.source=n.varg(arguments,1,null),this.ary=t,this.fns={added:n.fn.eatCall,removed:n.fn.eatCall,changed:n.fn.eatCall},this._createListener=function(t,n){var i=n;return{get:function(){return i},set:function(n){e.fns.changed(n,t),i=n},configurable:!0}},this._wrapIndicies=function(){n.iter(this.ary,function(t,n){var i=e._createListener(n,t);Object.defineProperty(e.ary,n+"",i)})},this.added=function(t){return this.fns.added=t,this},this.removed=function(t){return this.fns.removed=t,this},this.changed=function(t){return this.fns.changed=t,this},this.onto=function(t){return new function(t,e){var i=this;this.parent=t,this.element=e,this.consts={tag:"div"},this.fns={removal:function(t,n,e){n.remove()},transform:n.fn.identity,reset:function(t,n,e){n.html("")},placement:function(t,n,e){n.html(t)}},this.tag=function(t){return this.consts.tag=t,this},this._applyAdd=function(t,e){var r=n.tag(i.consts.tag);i.fns.placement(i.fns.transform(t),r,e),i.element.append(r)},this._applyRemove=function(t,n){var e=i.element.children(!1).ith(n);i.fns.removal(t,e,n)},this._applyChanged=function(t,n){var e=i.element.children(!1).ith(n);i.fns.reset(t,e,n),i.fns.placement(i.fns.transform(t),e,n)},this.removal=function(t){return this.fns.removal=t,this},this.transform=function(t){return this.fns.transform=t,this},this.placement=function(t){return this.fns.placement=t,this},this.reset=function(t){return this.fns.placement=t,this},this.and=function(){return t.changed(this._applyChanged),t.removed(this._applyRemove),t.added(this._applyAdd),this.parent.and()},this.begin=function(){return t.changed(this._applyChanged),t.removed(this._applyRemove),t.added(this._applyAdd),this.parent.begin(),this.element}}(this,t)},this.and=function(t){return new s(this.ary,this)},this.begin=function(){null!=this.source&&this.source.begin();var t=this.ary.push;this.ary.push=function(){for(var n=0;n<arguments.length;n++)e.fns.added(arguments[n],e.ary.length+n);var i=t.apply(e.ary,arguments);return e._wrapIndicies(),i};var n=this.ary.push;this.ary.pop=function(){var t=e.ary.length-1;e.fns.removed(e.ary[t],t);var i=n.apply(e.ary);return e._wrapIndicies(),i};var i=this.ary.splice;this.ary.splice=function(t,n){for(var r=0;r<n;r++){var s=r+t;e.fns.removed(e.ary[s],s)}var o=i.apply(e.ary,[t,n]);return e._wrapIndicies(),o};for(var r=0;r<this.ary.length;r++)e.fns.added(this.ary[r],r);return e._wrapIndicies(),this}}return Object.defineProperty(n,"here",{get:function(){return n.log("here"),"here"}}),n.initFunctions=[],n.inspectionFunctions=[],n.fn={eatCall:function(){},identity:function(t){return t},contradiction:function(){return!1},tautology:function(){return!0},resign:function(t){return-t},negation:function(t){return!t},call:function(t){return t()},notImplemented:function(){throw"Not implemented!"},cleanWhitespace:function(t){return t.replace(/\s+/g," ").trim()},removeWhitespace:function(t){return t.replace(/\s+/,"")}},n.config={debug:!1,documentRoot:document},arguments.length>0&&function t(n,e){for(var i in n)"object"==typeof e[i]?t(n[i],e[i]):void 0!==n[i]&&(e[i]=n[i])}(arguments[0],n.config),n.varg=function(t,n,e){return t.length>n?t[n]:e},n.varg.on=function(t){return function(e,i){return n.varg(t,e,i)}},n.prop=function(e,i){var r=n.varg(arguments,2,t),s=e.hasOwnProperty(i);return r===t?s:s?e[i]:r},n.prop.on=function(e){return function(i){n.prop.apply(this,[e,i,n.varg(arguments,1,t)])}},n.extends=function(t,n){var e=[].slice.call(arguments);e.splice(0,2),n.apply(t,e)},n.functionName=function(t){var n=/^function\s+([\w\$]+)\s*\(/.exec(t.toString());return n?n[1]:"<anonymous function>"},n.typeCheck=function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];if(null===i){if(null===t)return e-1}else{if(typeof t==i)return e-1;try{if(t instanceof i)return e-1}catch(t){}}if("any"==i)return e-1}var r=[];for(e=1;e<arguments.length;e++){var s=arguments[e];null==s?r.push("null"):"string"==typeof s?r.push(s):r.push(n.functionName(s))}throw"Incorrect parameter type: "+typeof t+" (expected one of "+r.join(", ")+")"},n.resolve=function(t){if("function"!=typeof t)return t;var n=[].slice.call(arguments);return n.splice(0,1),t.apply(null,n)},n.log=function(){n.config.debug&&console.log.apply(null,arguments)},n.time=function(){new Date;return data.getTime()},n.range=function(t){var n=0;t=t;arguments.length>1&&(n=arg,t=arguments[1]);for(var e=[],i=n;i<t;i++)e.push(i);return e},n.tag=function(t){var e=new i(document.createElement(t)),r=n.varg.on(arguments),s=r(1,null),o=r(2,"");return e.classify(s).html(o)},n.iter=function(t,e){switch(n.typeCheck(t,Array,"object")){case 0:for(var i=0;i<t.length;i++)e(t[i],i);break;case 1:for(var r in t)e(r,t[r])}},n.comprehension=function(t,n){for(var e=[],i=0;i<t.length;i++){var r=n(t[i],i);void 0!==r&&e.push(r)}return e},n.init=function(t){n.initFunctions.push(t)},n.inspection=function(t){n.inspectionFunctions.push(t)},n.timeout=function(t,n){var e=new function(t,n){this.handle=null,this.start=function(){return this.handle=setTimeout(t,n),this},this.cancel=function(){return clearTimeout(this.handle),this.handle=null,this}}(t,n);return e.start(),e},n.interval=function(t,n){var e=new function(t,n){this.milliseconds=n,this.handle=null,this.time=function(t){var n=null!=this.handle;return n&&this.stop(),this.milliseconds=t,n&&this.start(),this},this.start=function(){if(null!=this.handle)throw"Already started";return this.handle=setInterval(t,this.milliseconds),this},this.stop=function(){if(null==this.handle)throw"Not running";return clearInterval(this.handle),this.handle=null,this}}(t,n);return e.start(),e},n.snap=function(t,e){var i=[].slice.call(arguments);i.splice(0,2);var r=/\.\.\.\(([0-9]+)\)/;if(r.test(t)){var s,o=t.split(r),a=!1,c=0;return n.iter(o,function(t,r){a?c+=t:c>0?n.timeout(function(){n.snap.apply(n,[o[r],e].concat(i))},c):s=n.snap.apply(n,[o[r],e].concat(i)),a=!a}),s}for(var h={$e:e},u=2;u<arguments.length;u++){var f=arguments[u];if("object"==typeof f&&null!==f)for(var l in f)h["$"+l]=f[l];else h["$"+(u-2)]=f}function p(){throw[].slice.call(arguments).join(" ")+" (in snap: "+t.substring(0,t.length-1)+")"}function d(t){var e;if(void 0===t||0==t.length)t="$0";else if(e=/([a-z]+)\((.*?)\)/.exec(t)){var i=e[1],r=n.comprehension(e[2].split(/\s+/),n.fn.cleanWhitespace),s=!1;n.iter(n.snap.storage.functions,function(n,e){if(n==i)return t=e(r,d),s=!0,!1}),s||p("No such function:",i)}return"$"==t[0]&&(t=h[t]),"true"==t||"false"!=t&&t}function g(t,e,i){if(e=d(e),i.length>0)b.attr(t,e);else{var r;(r=/^([a-z]+)(?:\((.*?)\)|)$/.exec(t))||p("Invalid directive:",t);var s=r[1],o=void 0===r[2]?[]:r[2].split(/\s+/),a=n.comprehension(o,function(t){if((t=t.trim()).length>0)return t}),c=!1;n.iter(n.snap.storage.directives,function(n,i){if(s==n)return!1===i(a,e,b,d)&&p("Illegal call to directive:",t),c=!0,!1}),c||p("No such directive:",s)}}function v(t,e,i){var r=n.tag(t);if(e.length>0&&r.attr("id",e.substring(1)),i.length>0)for(var s=i.split("."),o=1;o<s.length;o++)r.classify(s[o]);return r}t+="&";for(var y,m=/(.*?)([>&^])/g,b=e,w=b;y=m.exec(t);){var _=y[2].length>0&&"&"==y[2],C=y[2].length>0&&"^"==y[2],k=y[1],x=/^([+\-]|)(\*|)([$a-z0-9]+)((?:\([$a-z0-9]+\))|)((?:#\w+)|)((?:\.[\w\-]+)+|)((?:\:{1,2}[$\w\s\-()]+(?:=[$\w\s.]+){0,1})+|)$/.exec(k),j=function(){return b};null==x&&p("Invalid element reference:",k);var A=x[1],N=x[2].length>0,P=x[3],q=x[4],I=x[5],$=x[6],L=x[7];if(q=q.length>0?d(q.substring(1,q.length-1)):null,0==A.length)"$e"==P?b=e:((b=b.children(P+I+$)).empty&&p("No matched element for reference:",k),null!=q&&(b=b.ith(q)));else{var R=!0;if(N&&(R=(b=b.children(P+I+$)).empty,null!=q&&((R=R||b.length<=q)||(b=b.ith(q))),R&&(b=b.back())),R){var T=b;b=v(P,I,$),j=function(){"-"==A?T.prepend(b):T.append(b)}}}if(L.length>0)for(var O,S=/:(:|)([$\w\s\-()]+)((?:=[$\w\s.]+)|)/g;O=S.exec(L);){var F=O[1],E=O[2],V=O[3].substring(1);E.length>0?g(E,V,F):g(E,"v",F)}j(),_?b.backChain&&(w=b,b=b.back()):C&&(w=b.back(),b=w.back())}return w},n.snap.storage={directives:{html:function(t,n,e){if(t.length>0)return!1;e.html(n)},text:function(t,n,e){if(t.length>0)return!1;e.text(n)},remove:function(t,n,e){if(t.length>0)return!1;e.remove()},wipe:function(t,n,e){if(t.length>0)return!1;e.html("")},class:function(t,e,i,r){if(0==t.length)return!1;var s=n.varg.on(t);i.classify(r(t[0]),r(s(1,!0)),+r(s(2,-1)))},declass:function(t,e,i,r){if(0==t.length)return!1;var s=n.varg.on(t);i.classify(r(t[0]),!r(s(1,!0)),+r(s(2,-1)))},css:function(t,n,e,i){if(0==t.length)return!1;e.css(i(t[0]),i(t[1]))}},functions:{null:function(t,n){return null===n(t[0])},notnull:function(t,n){return null!==n(t[0])}}},n.snap.directive=function(t,e){n.snap.storage.directives[t]=e},n.snap.function=function(t,e){n.snap.storage.functions[t]=e},n.requestProcessors=[],n.request=function(t,e){return new function(t,e){var i=this;this.fns={success:n.fn.eatCall,failure:n.fn.eatCall},this.storage={url:e,method:t,query:{},headers:{},body:null},this.success=function(t){return this.fns.success=t,this},this.failure=function(t){return this.fns.failure=t,this},this.json=function(t){return this.storage.headers["Content-Type"]="application/json",this.storage.body=n.unbound(t),this},this.text=function(t){return this.storage.headers["Content-Type"]=n.varg(arguments,1,"text/plain"),this.storage.body=t,this},this.header=function(t,n){return this.storage.headers[t]=n,this},this.query=function(t){return this.storage.query=t,this},this._processResponse=function(t){var e=t.getResponseHeader("Content-Type"),i=t.status,r=t.responseText;switch(e){case"application/json":r=JSON.parse(t.responseText)}n.log("Received "+i+" ("+this.storage.method+", "+this.storage.url+"):",r),(i<400?this.fns.success:this.fns.failure)(r,i)},this.send=function(r){var s=new XMLHttpRequest;n.iter(n.requestProcessors,function(t){t(i)});var o=this.storage.url,a=[];n.iter(this.storage.query,function(t,n){a.push(t+"="+encodeURIComponent(n))}),a.length>0&&(o+="?"+a.join("&")),s.onreadystatechange=function(){4==this.readyState&&i._processResponse(this)};var c="";if(null!=this.storage.body){var h=this.storage.headers["Content-Type"];switch(h){case"text/plain":break;case"application/json":c=JSON.stringify(this.storage.body);break;default:throw"Unknown request content type ("+h+")"}}s.open(this.storage.method,o,!0),n.iter(this.storage.headers,function(t,n){s.setRequestHeader(t,n)}),s.send(c),n.log("Sent ("+t+": "+e+")",this.storage.body)}}(t,e)},n.request.processor=function(t){n.requestProcessors.push(t)},n.binding=function(t){return t instanceof Array?new s(t):new r(t,n.varg(arguments,1))},n.binding.on=function(t){return function(e){return n.binding(t,e)}},n.binding.snap=function(t,e,i){switch(n.typeCheck(e,Array,"object")){case 0:"string"==typeof i&&(i={add:i});var r=n.binding(e).onto(t);n.prop(i,"add")&&r.placement(function(t,e,r){n.snap(i.add,e,t,{d:t,i:r})}),r.begin();case 1:r=n.binding.on(e);n.iter(i,function(e,i){switch(n.typeCheck(i,"string","function")){case 0:r(e).onto(t).placement(function(t,e,r){n.snap(i,e,t,{d:t,i:r})}).begin();break;case 1:i(r(e)).begin()}})}},n.unbound=function(t){switch(n.typeCheck(t,Array,"object","any")){case 0:return n.comprehension(t,n.unbound);case 1:if(null===t)return null;var e={};return n.iter(t,function(t,i){t.startsWith("__")||(e[t]=n.unbound(i))}),e;case 2:return t}},/complete|loaded|interactive/.test(document.readyState)?e():window&&window.addEventListener("DOMContentLoaded",e),n}