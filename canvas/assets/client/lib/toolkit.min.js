/*
# toolkit.js

*README* coming soon.

Author Robin Saxifrage | https://github.com/robinsax/toolkit.js

Licensed under Apache 2.0

*/
function createToolkit(){if(Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector),!t)var t=function(){};var e=function(t){return new r(t)};function n(t){return e.config.dataPrefix+"-"+t}function r(n){var i=this;this.origin=e.varg(arguments,1,null),this.set=function(){switch(n instanceof r&&(n=n.set.splice()),e.typeCheck(n,[Element,t,Array,"string"])){case 0:case 1:return[n];case 2:for(var i=0;i<n.length;i++){var s=n[i];s instanceof r&&(n[i]=s.set[0])}return n;case 3:return e.config.rootElement.querySelectorAll(n)}}(),this.length=this.set.length,this.empty=0==this.length,this.debug=function(){return console.log(e.varg(arguments,0,"Debug")+":",this),this},this.back=function(){if(null==this.origin)throw"Illegal back()";return this.origin},this.reverse=function(){var t=this.set.slice();return t.reverse(),new r(t,this)},this.ith=function(t){if(t<0||t>=this.length)throw"Out of bounds: "+t;return e.varg(arguments,1,!0)?new r(this.set[t],this):this.set[t]},this.reduce=function(t){var n;switch(e.typeCheck(t,["string","function"])){case 0:n=this.comprehension(function(e){if(e.is(t))return e});break;case 1:n=this.comprehension(t)}return new r(n,this)},this.extend=function(t){switch(e.typeCheck(t,[r,Array])){case 0:t=t.set;case 1:return t=e.comprehension(t,function(t){return t instanceof r?t.set[0]:t}),new r(this.set.concat(t),this)}},this.parents=function(){if(1==arguments.length)return this.parents("*",arguments[0]);var t,n=e.varg(arguments,0,null),i=e.typeCheck(n,[null,"string","function"]),s=e.varg(arguments,1,!0);function o(t,e){return null==n||1==i&&parent.matches(n)||2==i&&n(t,e)}return e.typeCheck(s,["boolean"]),s?(t=[],this.iter(function(e,n){for(var r=e.parentNode;r!==document;)o(r,n)&&t.push(r),r=r.parentNode},!1)):t=this.comprehension(function(t,e){if(o(t.parent,e))return t.parent},!1),new r(t,this)},this.children=function(){if(1==arguments.length&&"boolean"==typeof arguments[0])return this.children("*",arguments[0]);var t=e.varg(arguments,0,"*"),n=[];return e.varg(arguments,1,!0)?this.iter(function(r,i){e.iter(r.querySelectorAll(e.resolve(t,r,i)),function(t,e){-1==n.indexOf(t)&&n.push(t)})},!1):this.iter(function(r,i){e.iter(r.children,function(s,o){(null==t||s.matches(e.resolve(t,r,i)))&&n.push(s)})},!1),new r(n,this)},this.copy=function(){return new r(this.set[0].cloneNode(!0),this)},this.equals=function(t){switch(e.typeCheck(t,[Element,Array,r])){case 0:return 1==i.length&&i.set[0]==t;case 2:t=t.set;case 1:var n=!1;return iter(t,function(t){if(-1==i.set.indexOf(t))return n=!0,!1}),iter(i.set,function(e){if(-1==t.indexOf(e))return n=!0,!1}),!n&&i.length==t.length}},this.iter=function(t){for(var n=e.varg(arguments,1,!0),i=0;i<this.set.length;i++){var s=this.set[i];if(n&&(s=new r(s,this)),!1===t(s,i))break}return this},this.comprehension=function(t){for(var n=e.varg(arguments,1,!0),i=[],s=0;s<this.set.length;s++){var o=this.set[s];n&&(o=new r(o,this));var u=t(o,s);void 0!==u&&i.push(u)}return i},this.is=function(t){e.typeCheck(t,["string","function"]);for(var n=0;n<this.length;n++){var r=this.set[n];if(!r.matches(e.resolve(t,r,n)))return!1}return!0},this.classes=function(){var t=[];return this.iter(function(e){for(var n=e.className.split(/\s+/),r=0;r<n.length;r++){var i=n[r];-1==t.indexOf(i)&&t.push(i)}},!1),t},this.value=function(){if(arguments.length>0){arguments[0];return this.iter(function(t,e){t.value=v},!1),this}return"checkbox"==this.set[0].type?this.set[0].checked:this.set[0].value},this.attr=function(t){switch(e.typeCheck(t,["string","object"])){case 0:if(!(arguments.length>1))return this.set[0].hasAttribute(t)?this.set[0].getAttribute(t):null;var n=t,r=arguments[1];switch(e.typeCheck(r,[null,"string","function"])){case 0:this.iter(function(t,e){t.removeAttribute(n,null)},!1);break;default:this.iter(function(t,i){t.setAttribute(e.resolve(n,t,i),e.resolve(r,t,i))},!1)}break;case 1:this.iter(function(n,r){for(var i in t)n.setAttribute(i,e.resolve(t[i],n,r))},!1)}return this},this.css=function(t){function n(t,n){t=t.replace(/-([a-z])/g,function(t){return t[1].toUpperCase()}),i.iter(function(r,i){var s=e.resolve(n,r,i);"number"==typeof s&&(s+="px"),r.style[t]=s},!1)}switch(e.typeCheck(t,["string","object"])){case 0:if(!(arguments.length>1))return window.getComputedStyle(this.set[0]).getPropertyValue(t);n(t,arguments[1]);break;case 1:for(var r in t)n(r,t[r])}return this},this.on=function(t){function n(t,n){i.iter(function(i,s){e.prop(i,"__listeners__")||(i.__listeners__=[]);var o={event:e.resolve(t,i,s),func:function(t){n(new r(i),t,s)}};i.__listeners__.push(o),i.addEventListener(o.event,o.func)},!1)}switch(e.typeCheck(t,["function","string","object"])){case 0:case 1:n(t,arguments[1]);break;case 2:for(var s in t)n(s,t[s])}return this},this.off=function(t){return this.iter(function(n){var r=e.prop(n,"__listeners__",[]),i=[];e.iter(r,function(e,r){e.event==t&&(n.removeEventListener(e.event,e.func),i.push(r))}),e.iter(i,function(t){r=r.splice(t,1)})},!1),this},this.classify=function(t){function n(t,r,s){var o="."+t;"toggle"==r&&(f=function(t,e){return!t.is(o)}),i.iter(function(i,u){var c=e.resolve(r,i,u),a=i.classes();c?i.is(o)||(a.push(t),i.set[0].className=a.join(" ").trim()):i.is(o)&&(a.splice(a.indexOf(t),1),i.set[0].className=a.join(" ").trim());var f=e.resolve(s,i,u);f>=0&&e.defer(function(){n(t,!c,-1)},f)})}switch(e.typeCheck(t,["string","object"])){case 0:var r=e.varg.on(arguments);n(t,r(1,!0),r(2,-1));break;case 1:e.iter(t,n)}return this},this.remove=function(){return this.iter(function(t){null!=t.parentNode&&t.parentNode.removeChild(t)},!1),this},this.append=function(t){switch(e.typeCheck(t,[Array,r,Element])){case 0:var n=[];return e.iter(t,function(t){i.append(t).iter(function(t){n.push(t.set[0])})}),new r(n,this);case 1:return t.iter(function(n){n.remove(),i.set[0].appendChild(n.set[0]),e.config.callbacks.preInsert(t)}),t.origin=this,t;case 2:return i.set[0].appendChild(t),e.config.callbacks.preInsert(t),new r(t,this)}},this.prepend=function(t){switch(typeCheck(t,[Array,r,Element])){case 0:var e=[];return t=t.splice(0).reverse(),iter(t,function(t){i.prepend(t).iter(function(t){e.push(t.set[0])})}),new r(e,this);case 1:return t.reverse().iter(function(t){t.remove(),i.set[0].insertBefore(t.set[0],i.set[0].firstChild),config.config.callbacks.preInsert(t)}),t.origin=this,t;case 2:return i.set[0].insertBefore(t,this.set[0].firstChild),config.callbacks.preInsert(t),new r(t,this)}},this.tag=function(){return this.set[0].tagName},this.next=function(){var t=this.set[0].nextElementSibling;return null==t&&(t=[]),new r(t,this)},this.prev=function(){var t=this.set[0].previousElementSibling;return null==t&&(t=[]),new r(t,this)},this.html=function(){if(arguments.length>0){var t=arguments[0];return this.iter(function(n,r){n.innerHTML=e.resolve(t,n,r)},!1),this}return this.set[0].innerHTML},this.text=function(){if(arguments.length>0){var t=arguments[0];return this.iter(function(n,r){n.textContent=e.resolve(t,n,r)},!1),this}return this.set[0].textContent},this.select=function(){return this.set[0].select(),this},this.offset=function(){for(var t=0,e=0,n=this.set[0];null!=n;)t+=n.offsetLeft,e+=n.offsetTop,n=n.offsetParent;return{x:t,y:e}},this.size=function(){var t=this.set[0],e=t.getBoundingClientRect(),n={width:e.width,height:e.height};if(varg(arguments,0,!1)){var r=window.getComputedStyle(t,null);n.width+=r.getPropertyValue("margin-left")+r.getPropertyValue("margin-right"),n.height+=r.getPropertyValue("margin-top")+r.getPropertyValue("margin-bottom"),"border-box"==r.getPropertyValue("box-sizing")&&(n.width+=r.getPropertyValue("padding-left")+r.getPropertyValue("padding-right"),n.height+=r.getPropertyValue("padding-top")+r.getPropertyValue("padding-bottom"))}return n},this.bind=function(t,n){return e.binding(this,t,n)}}function i(t,n,r){if(!e.prop(n,r))throw"No such property: "+r;var i,s,o;if(e.prop(n,"__bindings__")||(n.__bindings__={}),e.prop(n.__bindings__,r)?n.__bindings__[r].push(this):(n.__bindings__[r]=[this],Object.defineProperty(n,r,(i=n[r],s=n.__bindings__[r],o=i,{get:function(){return o},set:function(t){e.iter(s,function(e){e.apply(t)}),o=t}}))),n[r]instanceof Array){var u=n[r];function c(){e.iter(u,function(t,e){var i;Object.defineProperty(u,e+"",(i=t,{get:function(){return i},set:function(t){i=t,n[r]=u},configurable:!0}))})}e.iter(["push","pop","splice"],function(t){var e=u[t];u[t]=function(){var t=e.apply(u,arguments);return c(),n[r]=u,t}}),c()}var a=e.config.binding.defaultReset,f=e.config.binding.defaultPlacement,h=e.config.binding.defaultTransform;this.placement=function(t){return f=t,this},this.transform=function(t){return h=t,this},this.reset=function(t){return a=t,this},this.apply=function(e){a(e,t),f(h(e),t)},this.begin=function(){return f(h(n[r]),t),t}}e.fn={identity:function(t){return t},eatCall:function(){}},e.config={debug:!1,rootElement:document,dataPrefix:"tk",callbacks:{preInsert:e.fn.eatCall,preXHR:e.fn.eatCall},requests:{defaultSuccess:e.fn.eatCall,defaultFailure:e.fn.eatCall,defaultResponseParser:e.fn.identity,defaultMimetype:"text/plain"},binding:{defaultPlacement:function(t,e){e.html(t)},defaultTransform:function(t,e){return t},defaultReset:e.fn.eatCall}},arguments.length>0&&function t(e,n){for(var r in n)"object"==typeof e[r]?t(e[r],n[r]):e[r]=n[r]}(e.config,arguments[0]),e.config.attrNames={bind:n("bind"),onto:n("onto"),viewFn:n("view-fn"),src:n("src"),callback:n("callback"),event:n("event"),on:n("on"),template:n("template")},e.debug=function(){e.config.debug&&console.log.apply(null,arguments)},e.millis=function(){return(new Date).getTime()},e.iter=function(t,n){switch(e.typeCheck(t,[NodeList,Array,"object"])){case 0:case 1:for(var r=0;r<t.length&&!1!==n(t[r],r);r++);return;case 2:for(var i in t)if(!1===n(i,t[i]))break;return}},e.comprehension=function(t,n){e.typeCheck(t,[Array]);for(var r=[],i=0;i<t.length;i++){var s=n(t[i],i);void 0!==s&&r.push(s)}return r},e.prop=function(t,e){var n=t.hasOwnProperty(e);return 2==arguments.length?n:n?t[e]:arguments[2]},e.prop.on=function(t){return function(n){return 2==arguments.length?e.prop(t,n,arguments[1]):e.prop(t,n)}},e.defer=function(t,e){setTimeout(t,e)},e.repeat=function(t,n){var r=setInterval(t,n);return e.varg(arguments,2,!1)&&t(),{stop:function(){clearInterval(r)}}},e.range=function(t){var e=0,n=t;arguments.length>1&&(e=t,n=arguments[1]);for(var r=[],i=e;i<n;i++)r.push(i);return r},e.functionName=function(t){var e=/^function\s+([\w\$]+)\s*\(/.exec(t.toString());return e?e[1]:"<anonymous function>"},e.extends=function(t,e){e.apply(t)},e.varg=function(t,e,n){return t.length>e?arguments.length>3&&arguments[3]&&null==t[e]?n:t[e]:n},e.varg.on=function(t){return function(n,r){return e.varg(t,n,r,e.varg(arguments,2,!1))}},e.typeCheck=function(t,n){n instanceof Array||(n=[n]);for(var r=-1,i=0;i<n.length;i++){var s=n[i];if(null==s){if(null==t){r=i;break}}else{if(typeof t==s){r=i;break}try{if(t instanceof s){r=i;break}}catch(t){}}}if(-1==r){var o=[];for(i=0;i<n.length;i++){var u=n[i];null==u?o.push("null"):"string"==typeof u?o.push(u):o.push(e.functionName(u))}throw"Incorrect parameter type "+typeof t+" (expected one of "+o.join(", ")+")"}return r},e.resolve=function(t){if("function"==typeof t){var n=[].slice.call(arguments);if(n.splice(0,1),e.varg(arguments,1,!0))for(var i=0;i<n.length;i++)n[i]instanceof Element&&(n[i]=new r(n[i]));return t.apply(null,n)}return t},e.tag=function(t){return new r(document.createElement(t))},e.binding=function(t,e,n){return new i(t,e,n)},e.binding.on=function(t){return function(n,r){e.binding(n,t,r)}},e.request=function(t,n){return new function(t,n){var r=e.config.requests.defaultSuccess,i=e.config.requests.defaultFailure,s=e.config.requests.defaultMimetype,o=e.config.requests.defaultResponseParser,u=null,c=null;this.success=function(t){return r=t,this},this.failure=function(t){return i=t,this},this.responseParser=function(t){return o=t,this},this.query=function(t){return c=t,this},this.json=function(t){return mimeType="application/json",u=JSON.stringify(t),this},this.send=function(){var a=new XMLHttpRequest;null!=c&&(n+="?"+e.comprehension(c,function(t,e){return t+"="+encodeURIComponent(e)}).join("&")),a.onreadystatechange=function(){if(4==this.readyState){var s=this.status,u=o(this.responseText);e.debug("Received ("+t+": "+n+"): "+s,u),(s<400?r:i)(u,s)}},a.open(t,n,!0),null!=u?a.setRequestHeader("Content-Type",s):u="",e.config.callbacks.preXHR(a,t,n,u),e.debug("Sent ("+t+": "+n+")",u),a.send(u)}}(t,n)};var s=[];function o(){e.iter(s,function(t){t()})}return e.init=function(t){return s.push(t),e},e.ToolkitSelection=r,e.Binding=i,/complete|loaded|interactive/.test(document.readyState)?o():window&&window.addEventListener("DOMContentLoaded",o),e}