/*
toolkit.js

Author: Robin Saxifrage
License: Apache 2.0
*/
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(function(){var n,i,r,e,s,c,t,f,o,u,a,d=[].indexOf;f={},o=function(u){return function(){var e,i,t,n,r,s,o;for(e=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return i._call.apply(this,t)},o=i=new u;;){for(t=0,n=(s=Object.getOwnPropertyNames(o)).length;t<n;t++)"function"==typeof o[r=s[t]]?e[r]=o[r]:Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(o,r));if(!(o=Object.getPrototypeOf(o)))break}return e}},e=function(){function e(){_classCallCheck(this,e),this.initFunctions=[],this.inspectionFunctions=[],this.modules=[]}return _createClass(e,[{key:"attach",value:function(e){return this.modules.push(e),this}},{key:"onto",value:function(e){var t,n,i,r;for(n=0,i=(r=this.modules).length;n<i;n++)(t=new(0,r[n])(e)).called&&(e[t.called]=t);return this}},{key:"init",value:function(){var e,t,n;for(e=0,t=(n=this.initFunctions).length;e<t;e++)(0,n[e])();return this}},{key:"inspect",value:function(e){var t,n,i;if(0<this.inspectionFunctions.length)for(e=e.extend(e.children()),t=0,n=(i=this.inspectionFunctions).length;t<n;t++)(0,i[t])(e);return this}}]),e}(),u=new e,n=function(){function i(e,t,n){_classCallCheck(this,i),this.tk=e,this.info={method:t,url:n,success:function(){return{}},failure:function(){return{}},query:{},headers:{},body:null}}return _createClass(i,[{key:"success",value:function(e){return this.info.success=e,this}},{key:"failure",value:function(e){return this.info.failure=e,this}},{key:"json",value:function(e){return this.info.headers["Content-Type"]="application/json",this.info.body=e,this}},{key:"data",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"text/plain";return this.info.headers["Content-Type"]=t,this.info.body=e,this}},{key:"header",value:function(e,t){return this.info.headers[e]=t,this}},{key:"query",value:function(e){return this.info.query=e,this}},{key:"send",value:function(){var e,i,t,n,r,s,o,u,a,l=this;if(n=function(e){var t,n,i;switch(i=e.status,n=e.getResponseHeader("Content-Type"),t=e.responseText,n){case"application/json":t=JSON.parse(t)}return l.tk.log("Received "+i+" ("+l.info.method+", "+l.info.url+")",t),(i<400?l.info.success:l.info.failure)(t,i)},e=this.info.url,o="",0<(r=Object.getOwnPropertyNames(this.info.query)).length&&(e+="?"+function(){var e,t,n;for(n=[],e=0,t=r.length;e<t;e++)i=r[e],n.push(i+"="+encodeURIComponent(this.info.query[i]));return n}.call(this).join("&")),this.info.body)switch(t=this.info.headers["Content-Type"]){case"application/json":o=JSON.stringify(this.info.body);break;default:throw"Unknown outgoing mimetype "+t}for(i in(a=new XMLHttpRequest).onreadystatechange=function(){if(4===this.readyState)return n(this)},a.open(this.info.method,e,!0),s=this.info.headers)u=s[i],a.setRequestHeader(i,u);return a.send(o),this.tk.log("Sent ("+this.info.method+", "+e+")",this.info.body)}}]),i}(),u.attach(o(function(){function t(e){_classCallCheck(this,t),this.tk=e,this.called="request"}return _createClass(t,[{key:"_call",value:function(e,t){return new n(this,e,t)}}]),t}())),Element&&(Element.prototype.matches=Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),c=function(){var e=function(){function y(e,t){var n,i,r;if(_classCallCheck(this,y),this.parent=t,e instanceof y)this.set=e.set.slice();else if(e instanceof Element||e instanceof Node||e instanceof Window)this.set=[e];else if(e instanceof NodeList||e instanceof Array)for(this.set=[],i=0,r=e.length;i<r;i++)n=e[i],this.set=this.set.concat(y.clean(n));else{if("string"!=typeof e)throw"Illegal selection: "+e;this.set=y.tk.config.root.querySelectorAll(e)}this.length=this.set.length,this.empty=0===this.length}return _createClass(y,null,[{key:"clean",value:function(e){var t,n,i,r;if(e instanceof Node)return[e];for(e instanceof y&&(e=e.set),t=[],i=0,r=e.length;i<r;i++)(n=e[i])instanceof y?t=t.concat(n.set):t.push(n);return t}}]),_createClass(y,[{key:"back",value:function(){if(!this.parent)throw"Illegal back";return this.parent}},{key:"ith",value:function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];if(e<0||e>this.length)throw"Out of bounds: "+e;return t?new y(this.set[e],this):this.set[e]}},{key:"first",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];return this.ith(0,e)}},{key:"reversed",value:function(){var e;return(e=this.set.slice()).reverse(),new y(e,this)}},{key:"reduce",value:function(t){var e;switch(void 0===t?"undefined":_typeof(t)){case"string":e=this.comp(function(e){if(e.is(t))return e});break;case"function":e=this.comp(t);break;default:throw"Illegal reducer"}return new y(e,this)}},{key:"extend",value:function(e){var t;if(e instanceof y)t=e.set;else{if(!(e instanceof Array||e instanceof NodeList))throw"Illegal extension";t=y.clean(e)}return new y(this.set.concat(t,this))}},{key:"parent",value:function(){return this.set[0].parentNode||null}},{key:"search",value:function(e){if(!e)throw"No condition";return new y(this.reduce(e).set.concat(this.children(e).set),this)}},{key:"parents",value:function(){var i,n,r,s=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"*",o=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];if((n=["string","function","boolean"].indexOf(void 0===s?"undefined":_typeof(s)))<0)throw"Illegal condition";return 2===n&&(n=0,s="*",o=!1),i=function(e,t){return 0===n?e.is(s):s(e,t)},r=[],this.iter(function(e,t){var n;for(n=e.first(!1).parentNode;n!==y.tk.config.root&&null!==n;){if(i(tk(n,t))&&r.push(n),!o)return;n=n.parentNode}}),new y(r,this)}},{key:"children",value:function(){var h,c,f=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"*",d=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];if((h=["string","function"].indexOf(void 0===f?"undefined":_typeof(f)))<0)throw"Illegal condition";return c=[],this.iter(function(e,t){var n,i,r,s,o,u,a,l;if((e=e.first(!1)).nodeType!==Node.TEXT_NODE){if(l=[],0===h)if(d)l=e.querySelectorAll(f);else for(r=0,o=(a=e.children).length;r<o;r++)(i=a[r]).matches(f)&&(l=i);else for(new y(n=d?e.querySelectorAll("*"):e.children),s=0,u=n.length;s<u;s++)i=n[s],f(wrap,t)&&(l=i);return c=c.concat(l)}}),new y(c,this)}},{key:"copy",value:function(){var e;return e=this.set[0].cloneNode(!0),new y(e,this)}},{key:"iter",value:function(e){var t,n,i,r;for(t=n=0,i=(r=this.set).length;n<i&&!1!==e(new y(r[t]),t);t=++n);return this}},{key:"comp",value:function(e){var t,n,i,r,s,o;for(s=[],t=n=0,i=(r=this.set).length;n<i;t=++n)void 0!==(o=e(new y(r[t]),t))&&s.push(o);return s}},{key:"is",value:function(e){var t,n,i,r,s,o;for(t=["string","function"].indexOf(void 0===e?"undefined":_typeof(e)),i=r=0,s=(o=this.set).length;r<s;i=++r){if(n=o[i],!(0!==t||n.nodeType!==Node.TEXT_NODE&&n.matches(e)))return!1;if(1===t&&!e(new y(n),i))return!1}return!0}},{key:"classes",value:function(){var e,t,n,i,r,s,o,u,a;for(e=[],n=i=0,s=(a=this.set).length;i<s;n=++i)for(r=0,o=(u=a[n].className.split(/\s+/)).length;r<o;r++)t=u[r],d.call(e,t)<0&&e.push(t);return e}},{key:"focus",value:function(){return this.set[0].focus(),this}},{key:"value",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:f;return t===f?"checkbox"===this.set[0].type?this.set[0].checked:"file"===this.set[0].type?this.set[0].files:(t=this.set[0].value)?"number"===this.set[0].type?+t:t:null:(this.iter(function(e){return"select"===e.tag().toLowerCase()?e.children("option").attr("selected",function(e){return!!e.attr("value"===t)||null}):e.first(!1).value=t}),this)}},{key:"attr",value:function(n){var e,t,i,r,s,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:f;if("string"==typeof n){if(o===f)return this.set[0].getAttribute(n);for(t=0,i=(s=this.set).length;t<i;t++)e=s[t],"function"==typeof(r=o)&&(r=r(new y(e,this))),null===r?e.removeAttribute(n):e.setAttribute(n,r);return this}if("object"===(void 0===n?"undefined":_typeof(n)))return this.iter(function(e){var t;for(t in n)o=n[t],e.attr(t,o)}),this;throw"Illegal argument: "+n}},{key:"css",value:function(e){var t,n,s=this,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:f;if(t=function(i,r){return i=i.replace(/-([a-z])/g,function(e){return e[1].toUpperCase()}),s.iter(function(e,t){var n;return"number"==typeof(n=y.tk.resolve(r,e,t))&&(n+="px"),e.set[0].style[i]=n})},"string"==typeof e){if(i===f)return window.getComputedStyle(this.set[0]).getPropertyValue(e);t(e,i)}else{if("object"!==(void 0===e?"undefined":_typeof(e)))throw"Illegal argument";for(n in e)t(n,i=e[n])}return this}},{key:"on",value:function(e){var t,n,i,r,s,o,u,a=this,l=1<arguments.length&&void 0!==arguments[1]?arguments[1]:f;if(t=function(r,s){return a.iter(function(t,e){var n,i;return(n=t.first(!1)).__listeners__||(n.__listeners__=[]),"function"==typeof r&&(r=r(t,e)),i={event:r,callback:s},n.__listeners__.push(i),n.addEventListener(i.event,function(e){return s(t,e)})})},"string"==typeof e){if(l===f){if(null!=this.set[0].__listeners__){for(n=[],i=0,r=(o=this.set[0].__listeners__).length;i<r;i++)(u=o[i]).event===e&&n.push(u.callback);return n}return[]}t(e,l)}else{if("object"!==(void 0===e?"undefined":_typeof(e)))throw"Illegal argument";for(s in e)t(s,e[s])}return this}},{key:"off",value:function(i){var e,t,n,r,s,o,u,a;for(t=0,r=(u=this.set).length;t<r;t++){for(e=u[t],n=0,s=(o=null!=e.__listeners__||[]).length;n<s;n++)(a=o[n]).event===i&&e.removeEventListener(a.event,a.callback);e.__listeners__=function(){var e,t,n;for(n=[],e=0,t=o.length;e<t;e++)(a=o[e]).event!==i&&n.push(a);return n}()}return this}},{key:"classify",value:function(e){var h,t,n,i=this,r=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:f;if(h=function(u,a,l){return"toggle"===a&&(a=function(e,t){return d.call(e.classes(),u)<0}),i.iter(function(e,t){var n,i,r,s,o;if("function"==typeof(i=a)&&(i=i(e,t)),n=e.classes(),r=0<=d.call(n,u),i&&!r?n.push(u):!i&&r&&(s=n.indexOf(u),n.splice(s,1)),e.set[0].className=n.join(" ").trim(),l!==f)return"function"==typeof(o=l)&&(o=o(e,t)),y.tk.timeout(o,function(e){return h(u,!i,f)})})},"string"==typeof e)h(e,r,s);else for(n in e)t=e[n],h(n,t,f);return this}},{key:"remove",value:function(){var e,t,n,i;for(t=0,n=(i=this.set).length;t<n;t++)null!==(e=i[t]).parentNode&&e.parentNode.removeChild(e);return this}},{key:"append",value:function(e){var t,n,i,r;for((e=new y(e,this)).remove(),this.first().parents("body").empty||y.tk.guts.inspect(e),n=0,i=(r=e.set).length;n<i;n++)t=r[n],this.set[0].appendChild(t);return e}},{key:"prepend",value:function(e){var t,n,i;for((e=new y(e,this)).remove(),this.first().parents("body").empty||y.tk.guts.inspect(e),n=(i=e.set).length-1;0<=n;n+=-1)t=i[n],this.set[0].insertBefore(t,this.set[0].firstChild);return e}},{key:"replace",value:function(e){var t;return this.first().parents("body").empty||((t=e)instanceof y||(t=new y(t,this)),y.tk.guts.inspect(t)),e instanceof y&&(e=e.first(!1)),this.set[0].parentNode.replaceChild(e,this.set[0]),new y(e,this.parent)}},{key:"tag",value:function(){return this.set[0].tagName}},{key:"next",value:function(){var e,t,n,i,r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:f;if(r===f)return this.empty||null===this.set[0].nextSibling?new y([]):new y(this.set[0].nextSibling,this);for(!r instanceof y&&(r=tk(r)),t=0,n=(i=r.set).length;t<n;t++)e=i[t],this.set[0].parentNode.insertBefore(e,this.set[0].nextSibling);return r.parent=this,r}},{key:"prev",value:function(){var e,t,n,i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:f;if(i===f)return this.empty||null===this.set[0].previousSibling?new y([]):new y(this.set[0].previousSibling,this);for(!i instanceof y&&(i=tk(i)),t=(n=i.set).length-1;0<=t;t+=-1)e=n[t],this.set[0].parentNode.insertBefore(e,this.set[0]);return i.parent=this,i}},{key:"html",value:function(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:f;return n===f?this.set[0].innerHTML:(this.iter(function(e,t){return e.set[0].innerHTML=y.tk.resolve(n,e,t)}),this)}},{key:"text",value:function(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:f;return n===f?this.set[0].textContent:(this.iter(function(e,t){return e.set[0].textContent=y.tk.resolve(n,e,t)}),this)}},{key:"select",value:function(){return this.set[0].select(),this}},{key:"offset",value:function(){var e,t,n=0<arguments.length&&void 0!==arguments[0]&&arguments[0];for(t={x:0,y:0},e=this.set[0];null!==e&&(t.x+=e.offsetLeft||0,t.y+=e.offsetTop||0,!n);)e=e.offsetParent;return t}},{key:"size",value:function(){var e,t,n,i,r=0<arguments.length&&void 0!==arguments[0]&&arguments[0];return n={width:(e=(t=this.set[0]).getBoundingClientRect()).width,height:e.height},r&&(i=window.getComputedStyle(t,null),n.width+=i.getPropertyValue("margin-left"),n.width+=i.getPropertyValue("margin-right"),n.height+=i.getPropertyValue("margin-top"),n.height+=i.getPropertyValue("margin-bottom"),"border-box"===i.getPropertyValue("box-sizing")&&(n.width+=i.getPropertyValue("padding-left"),n.width+=i.getPropertyValue("padding-right"),n.height+=i.getPropertyValue("padding-top"),n.height+=i.getPropertyValue("padding-bottom"))),n}},{key:"data",value:function(){var e;for(e=this.set[0];null==e._tkData;)if(!(e=e.parentNode))throw"No data.";return e._tkData}},{key:"key",value:function(){var e;for(e=this.set[0];null==e._tkKey;)if(!(e=e.parentNode))throw"No key.";return e._tkKey}},{key:"index",value:function(){var e;for(e=this.set[0];null==e._tkIndex;)if(!(e=e.parentNode))throw"No index.";return e._tkIndex}}]),y}();return e.tk=null,e}.call(this),u.attach(function e(t){_classCallCheck(this,e),(t.ToolkitSelection=c).tk=t}),s=function(){function i(e,t){var n;_classCallCheck(this,i),this.object=e,this.property=t,this.object.__listeners__||Object.defineProperty(this.object,"__listeners__",{value:{},enumerable:!1,writable:!0}),this.object.__listeners__[this.property]||(this.object.__listeners__[this.property]=[],n=this._descriptor(this.object[this.property],this.object.__listeners__[this.property]),Object.defineProperty(this.object,this.property,n)),this.object.__listeners__[this.property].push(this),this._changed=function(){},this._accessed=function(){}}return _createClass(i,[{key:"_descriptor",value:function(e,i){var r;return r=e,{get:function(){var e,t;for(e=0,t=i.length;e<t;e++)i[e]._accessed(r);return r},set:function(e){var t,n;if(r===e)return r;for(r=e,t=0,n=i.length;t<n;t++)i[t]._changed(e);return r}}}},{key:"changed",value:function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];return this._changed=e,t&&e(this.object[this.property]),this}},{key:"accessed",value:function(e){return this._accessed=e,this}},{key:"remove",value:function(){var e;return e=this.object.__listeners__[this.property].indexOf(this),this.object.__listeners__[this.property].splice(e,1),this}}]),i}(),r=function(){function t(e){_classCallCheck(this,t),this.array=e,this.array.__listeners__||this._mixinListeners(),this.array.__listeners__.push(this),this._added=function(){},this._removed=function(){},this._accessed=function(){}}return _createClass(t,[{key:"_mixinListeners",value:function(){var r,h,p,_,g,k=this;return _=this.array.__listeners__=[],g=function(){var e,t,n,i,r;for(r=[],t=n=0,i=k.array.length;0<=i?n<i:i<n;t=0<=i?++n:--n)e=k._indexDescriptor(k.array[t],t,_),r.push(Object.defineProperty(k.array,t+"",e));return r},h=this.array.push,this.array.push=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var i,r,s,o,u,a,l;for(l=k.array.length,h.apply(k.array,t),g(),i=s=0,u=t.length;s<u;i=++s)for(r=t[i],o=0,a=_.length;o<a;o++)_[o]._added(r,l+i);return k.array.length},r=this.array.pop,this.array.pop=function(){var e,t,n,i;for(i=k.array[e=k.array.length-1],r.apply(k.array),g(),t=0,n=_.length;t<n;t++)_[t]._removed(i,e);return i},p=this.array.splice,this.array.splice=function(r,s){for(var e=arguments.length,t=Array(2<e?e-2:0),n=2;n<e;n++)t[n-2]=arguments[n];var o,i,u,a,l,h,c,f,d,y,v;for(y=function(){var e,t,n,i;for(i=[],o=e=t=r,n=r+s;t<=n?e<n:n<e;o=t<=n?++e:--e)i.push(this.array[o]);return i}.call(k),v=p.apply(k.array,[r,s].concat(t)),g(),o=i=0,f=s;0<=f?i<f:f<i;o=0<=f?++i:--i)for(u=0,l=_.length;u<l;u++)_[u]._removed(y[o],r+o);for(o=a=0,d=t.length;0<=d?a<d:d<a;o=0<=d?++a:--a)for(c=0,h=_.length;c<h;c++)_[c]._added(k.array[r+o],o);return v}}},{key:"_indexDescriptor",value:function(e,s,o){var u;return u=e,{get:function(){var i;return function(){var e,t,n;for(n=[],e=0,t=o.length;e<t;e++)i=o[e],n.push(i._accessed(u))}(),u},set:function(e){var t,n,i,r;if(u===e)return u;for(u=e,t=0,i=o.length;t<i;t++)o[t]._removed(u,s);for(n=0,r=o.length;n<r;n++)o[n]._added(e,s);return u},configurable:!0}}},{key:"added",value:function(e){var t,n,i,r;for(this._added=e,t=n=0,i=(r=this.array).length;n<i;t=++n)e(r[t],t);return this}},{key:"removed",value:function(e){return this._removed=e,this}},{key:"accessed",value:function(e){return this._accessed=e,this}}]),t}(),u.attach(o(function(){function e(){_classCallCheck(this,e),this.called="listener"}return _createClass(e,[{key:"_call",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:f;if(e instanceof Array)return new r(e);if("object"===(void 0===e?"undefined":_typeof(e)))return new s(e,t);throw"Invalid parameter"}}]),e}())),t=function(){function n(e,t){_classCallCheck(this,n),this.tk=e,this.definition=t,this._data=null,this._live=!1,this._reference=null,this._result=null,this._listeners=!1,this._inspection=null}return _createClass(n,[{key:"inspection",value:function(e){return this._inspection=e,this}},{key:"data",value:function(){return this._data=arguments,this}},{key:"live",value:function(){return this._live=!0,this}},{key:"copyListeners",value:function(){return this._listeners=!0,this}},{key:"_diffNodes",value:function(e,t){var n;return(void 0===e?"undefined":_typeof(e))!==(void 0===t?"undefined":_typeof(t))||"string"==typeof e&&e!==t||e.tag!==t.tag||null!=(null!=(n=e.attributes)?n.forceRender:void 0)}},{key:"_updateAttrs",value:function(e,t,n){var i,r;for(i in t)n[i]&&n[i]===t[i]||e.setAttribute(i,t[i]);for(i in r=[],n)t[i]?r.push(void 0):r.push(e.removeAttribute(i));return r}},{key:"_update",value:function(n,e,t){var i,r,s,o,u,a,l,h,c,f=this,d=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;if(!t)return n.appendChild(this._create(e));if(e){if(this._diffNodes(e,t)){if(i=this._create(e),this._listeners&&null!=n.childNodes[d].__listeners__){for(o=0,u=(l=n.childNodes[d].__listeners__).length;o<u;o++)a=l[o],i.addEventListener(a.event,function(e){return a.callback(f.tk(i),e)});i.__listeners__=n.childNodes[d].__listeners__}return n.replaceChild(i,n.childNodes[d])}if(e.tag){for(this._updateAttrs(n.childNodes[d],e.attributes,t.attributes),e.__data__&&this.tk.iter(e.__data__,function(e,t){return n.childNodes[d][e]=t}),c=Math.max(e.children.length,t.children.length),s=0,h=[];s<c;){try{this._update(n.childNodes[d],e.children[s],t.children[s],s)}catch(e){if("x"!==(r=e))throw r;s--}h.push(s++)}return h}}else if(n.childNodes[d])throw n.removeChild(n.childNodes[d]),"x"}},{key:"_create",value:function(i){var e,r,t,n,s,o,u,a,l,h,c,f,d;if(!i)return document.createTextNode("");if("string"==typeof i||"number"==typeof i)f=document.createTextNode(i);else if("function"==typeof i)f=this._create(i());else if(i instanceof Array)f=function(){var e,t,n;for(n=[],e=0,t=i.length;e<t;e++)r=i[e],n.push(this._create(r));return n}.call(this);else{for(l in f=document.createElement(i.tag),h=i.attributes)d=h[l],"markup"===l?f.innerHTML=d:f.setAttribute(l,d);if(null!=i.__data__&&this.tk.iter(i.__data__,function(e,t){return f[e]=t}),null!=i.children)for(t=0,s=(c=i.children).length;t<s;t++)if(e=c[t],(a=this._create(e))instanceof Array)for(n=0,o=a.length;n<o;n++)u=a[n],f.appendChild(u);else f.appendChild(a);i.result=f,this._inspection&&this._inspection(this.tk(f))}return f}},{key:"render",value:function(){var e,t,n;return n=this.definition.apply(null,this._data),this._live?(this._reference?(e=this._result.parentNode,t=Array.prototype.indexOf.call(e.childNodes,this._result),this._update(e,n,this._reference,t),this._result=e.childNodes[t]):this._result=this._create(n),this._reference=n,this.tk(this._result)):this.tk(this._create(n))}}]),n}(),u.attach(o(function(){function e(){_classCallCheck(this,e),this.called="template"}return _createClass(e,[{key:"_call",value:function(e){return new t(this,e)}},{key:"_flatten",value:function(e){var t,n,i,r,s;for(t=!1;!t;){for(s=[],t=!0,i=0,r=e.length;i<r;i++)(n=e[i])instanceof Array?(s=s.concat(n),t=!1):s.push(n);e=s}return s}},{key:"tag",value:function(e,t){for(var n=arguments.length,i=Array(2<n?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return{tag:e,attributes:t||{},children:this._flatten(i)}}}]),e}())),i=o(function(){function t(){var e;_classCallCheck(this,t),this.initialized=!1,e=!0,Object.defineProperty(this,"here",{get:function(){if(!e)return console.log("here"),"here";e=!1}})}return _createClass(t,[{key:"_call",value:function(e){return new c(e)}},{key:"_finalize",value:function(e){var t,n,i,r,s=this;this.config={root:null!=(t=e.root)?t:"undefined"!=typeof document&&null!==document?document:null,debug:null!=(n=e.debug)&&n,iteration:{ignoreKeys:["__listeners__"].concat(null!=(i=null!=(r=e.iteration)?r.ignoreKeys:void 0)?i:[])}},this.guts=u.onto(this),/complete|loaded|interactive/.test("undefined"!=typeof document&&null!==document?document.readyState:void 0)?(this.initialized=!0,this.guts.init()):"undefined"!=typeof window&&null!==window&&window.addEventListener("DOMContentLoaded",function(){return s.initialized=!0,s.guts.init()})}},{key:"init",value:function(e){return this.initialized&&e(),this.guts.initFunctions.push(e),this}},{key:"inspection",value:function(e){return this.guts.inspectionFunctions.push(e),this}},{key:"log",value:function(){for(var e,t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];return(null!=(e=this.config)?e.debug:void 0)&&console.log.apply(null,n),n[0]}},{key:"warn",value:function(){for(var e,t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];return(null!=(e=this.config)?e.debug:void 0)&&console.warn.apply(null,n),n[0]}},{key:"resolve",value:function(e){if("function"!=typeof e)return e;for(var t=arguments.length,n=Array(1<t?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return e.apply(null,n)}},{key:"time",value:function(){return(new Date).getTime()}},{key:"range",value:function(e){var t,n,i,r,s,o,u=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;for(i=0,u&&(i=e,e=u),o=[],t=n=r=i,s=e;r<=s?n<s:s<n;t=r<=s?++n:--n)o.push(t);return o}},{key:"iter",value:function(e,t){var n,i,r,s,o;if(e instanceof Array)for(n=i=0,r=e.length;i<r&&!1!==t(e[n],n);n=++i);else{if("object"!==(void 0===e?"undefined":_typeof(e)))throw"Not iterable: "+e;for(s in e)if(o=e[s],!(0<=d.call(this.config.iteration.ignoreKeys,s))&&!1===t(s,o))break}}},{key:"_markData",value:function(e,t){return e.__data__=t,e}},{key:"_isVirtualDOMNode",value:function(e){return null!=e.tag&&null!=e.attributes&&null!=e.children}},{key:"comp",value:function(e,t){var n,i,r,s,o,u,a,l;if(u=[],e instanceof Array)for(n=r=0,s=e.length;r<s;n=++r)null!=(a=t(i=e[n],n))&&(this._isVirtualDOMNode(a)?u.push(this._markData(a,{_tkData:i,_tkIndex:n})):u.push(a));else{if("object"!==(void 0===e?"undefined":_typeof(e)))throw"Not iterable: "+e;for(o in e)l=e[o],0<=d.call(this.config.iteration.ignoreKeys,o)||null!=(a=t(o,l))&&(this._isVirtualDOMNode(a)?u.push(this._markData(a,{_tkData:l,_tkKey:o})):u.push(a))}return u}},{key:"timeout",value:function(e,t){var n;return n=setTimeout(t,e),{cancel:function(){return clearTimeout(n)}}}},{key:"transition",value:function(t){var e,n,i,r;return requestAnimationFrame?(n=null,r=function(e){if(null===n?(n=e,e=0):e-=n,!1!==t(e))return requestAnimationFrame(r)},requestAnimationFrame(r)):(i=0,e=timeout(16,function(){return!1===t(i)&&e.cancel(),i+=16}))}},{key:"update",value:function(e,t){var n,i;for(n in i=[],t)null==e[n]||"object"!==_typeof(e[n])||"object"!==_typeof(t[n])?i.push(e[n]=t[n]):this.update(e[n],t[n]);return i}},{key:"tag",value:function(e){var t,n,i,r,s,o,u=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};for(r in n=document.createElement(e),u)o=u[r],n.setAttribute(r,o);for(var a=arguments.length,l=Array(2<a?a-2:0),h=2;h<a;h++)l[h-2]=arguments[h];for(i=0,s=l.length;i<s;i++)"string"==typeof(t=l[i])?n.appendChild(document.createTextNode(t)):n.appendChild(this.tag(t));return new c(n)}}]),t}()),a={create:function(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return(e=new i)._finalize(t),e}},"undefined"!=typeof window&&null!==window?window.toolkit=a:module.exports=a}).call(void 0);