/*
toolkit.js

Author: Robin Saxifrage
License: Apache 2.0
*/
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_createClass=function(){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(function(){var n,i,r,t,s,c,e,f,o,a,u,d=[].indexOf;f={},o=function(a){return function(){var t,i,e,n,r,s,o;for(t=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return i._call.apply(this,e)},o=i=new a;;){for(e=0,n=(s=Object.getOwnPropertyNames(o)).length;e<n;e++)"function"==typeof o[r=s[e]]?t[r]=o[r]:Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(o,r));if(!(o=Object.getPrototypeOf(o)))break}return t}},t=function(){function t(){_classCallCheck(this,t),this.initFunctions=[],this.inspectionFunctions=[],this.modules=[]}return _createClass(t,[{key:"attach",value:function(t){return this.modules.push(t),this}},{key:"onto",value:function(t){var e,n,i,r;for(n=0,i=(r=this.modules).length;n<i;n++)(e=new(0,r[n])(t)).called&&(t[e.called]=e);return this}},{key:"init",value:function(){var t,e,n;for(t=0,e=(n=this.initFunctions).length;t<e;t++)(0,n[t])();return this}},{key:"inspect",value:function(t){var e,n,i;if(0<this.inspectionFunctions.length)for(t=t.extend(t.children()),e=0,n=(i=this.inspectionFunctions).length;e<n;e++)(0,i[e])(t);return this}}]),t}(),a=new t,n=function(){function i(t,e,n){_classCallCheck(this,i),this.tk=t,this.info={method:e,url:n,success:function(){return{}},failure:function(){return{}},query:{},headers:{},body:null}}return _createClass(i,[{key:"success",value:function(t){return this.info.success=t,this}},{key:"failure",value:function(t){return this.info.failure=t,this}},{key:"json",value:function(t){return this.info.headers["Content-Type"]="application/json",this.info.body=t,this}},{key:"data",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"text/plain";return this.info.headers["Content-Type"]=e,this.info.body=t,this}},{key:"header",value:function(t,e){return this.info.headers[t]=e,this}},{key:"query",value:function(t){return this.info.query=t,this}},{key:"send",value:function(){var t,i,e,n,r,s,o,a,u,l=this;if(n=function(t){var e,n,i;switch(i=t.status,n=t.getResponseHeader("Content-Type"),e=t.responseText,n){case"application/json":e=JSON.parse(e)}return l.tk.log("Received "+i+" ("+l.info.method+", "+l.info.url+")",e),(i<400?l.info.success:l.info.failure)(e,i)},t=this.info.url,o="",0<(r=Object.getOwnPropertyNames(this.info.query)).length&&(t+="?"+function(){var t,e,n;for(n=[],t=0,e=r.length;t<e;t++)i=r[t],n.push(i+"="+encodeURIComponent(this.info.query[i]));return n}.call(this).join("&")),this.info.body)switch(e=this.info.headers["Content-Type"]){case"application/json":o=JSON.stringify(this.info.body);break;default:throw"Unknown outgoing mimetype "+e}for(i in(u=new XMLHttpRequest).onreadystatechange=function(){if(4===this.readyState)return n(this)},u.open(this.info.method,t,!0),s=this.info.headers)a=s[i],u.setRequestHeader(i,a);return u.send(o),this.tk.log("Sent ("+this.info.method+", "+this.info.url+")",this.info.body)}}]),i}(),a.attach(o(function(){function e(t){_classCallCheck(this,e),this.tk=t,this.called="request"}return _createClass(e,[{key:"_call",value:function(t,e){return new n(this,t,e)}}]),e}())),c=function(){var t=function(){function y(t,e){var n,i,r;if(_classCallCheck(this,y),this.parent=e,t instanceof y)this.set=t.set.slice();else if(t instanceof Element||t instanceof Node||t instanceof Window)this.set=[t];else if(t instanceof NodeList||t instanceof Array)for(this.set=[],i=0,r=t.length;i<r;i++)n=t[i],this.set=this.set.concat(y.clean(n));else{if("string"!=typeof t)throw"Illegal selection: "+t;this.set=y.tk.config.root.querySelectorAll(t)}this.length=this.set.length,this.empty=0===this.length}return _createClass(y,null,[{key:"clean",value:function(t){var e,n,i,r;if(t instanceof Node)return[t];for(t instanceof y&&(t=t.set),e=[],i=0,r=t.length;i<r;i++)(n=t[i])instanceof y?e=e.concat(n.set):e.push(n);return e}}]),_createClass(y,[{key:"back",value:function(){if(!this.parent)throw"Illegal back";return this.parent}},{key:"ith",value:function(t){var e=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];if(t<0||t>this.length)throw"Out of bounds: "+t;return e?new y(this.set[t],this):this.set[t]}},{key:"first",value:function(){var t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];return this.ith(0,t)}},{key:"reversed",value:function(){var t;return(t=this.set.slice()).reverse(),new y(t,this)}},{key:"reduce",value:function(e){var t;switch(void 0===e?"undefined":_typeof(e)){case"string":t=this.comp(function(t){if(t.is(e))return t});break;case"function":t=this.comp(e);break;default:throw"Illegal reducer"}return new y(t,this)}},{key:"extend",value:function(t){var e;if(t instanceof y)e=t.set;else{if(!(t instanceof Array||t instanceof NodeList))throw"Illegal extension";e=y.clean(t)}return new y(this.set.concat(e,this))}},{key:"parents",value:function(){var i,n,r,s=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"*",o=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];if((n=["string","function","boolean"].indexOf(void 0===s?"undefined":_typeof(s)))<0)throw"Illegal condition";return 2===n&&(n=0,s="*",o=!1),i=function(t,e){return 0===n?t.is(s):s(t,e)},r=[],this.iter(function(t,e){var n;for(n=t.first(!1).parentNode;n!==y.tk.config.root&&null!==n;){if(i(tk(n,e))&&r.push(n),!o)return;n=n.parentNode}}),new y(r,this)}},{key:"children",value:function(){var h,c,f=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"*",d=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];if((h=["string","function"].indexOf(void 0===f?"undefined":_typeof(f)))<0)throw"Illegal condition";return c=[],this.iter(function(t,e){var n,i,r,s,o,a,u,l;if((t=t.first(!1)).nodeType!==Node.TEXT_NODE){if(l=[],0===h)if(d)l=t.querySelectorAll(f);else for(r=0,o=(u=t.children).length;r<o;r++)(i=u[r]).matches(f)&&(l=i);else for(new y(n=d?t.querySelectorAll("*"):t.children),s=0,a=n.length;s<a;s++)i=n[s],f(wrap,e)&&(l=i);return c=c.concat(l)}}),new y(c,this)}},{key:"copy",value:function(){var t;return t=this.set[0].cloneNode(!0),new y(t,this)}},{key:"iter",value:function(t){var e,n,i,r;for(e=n=0,i=(r=this.set).length;n<i&&!1!==t(new y(r[e]),e);e=++n);return this}},{key:"comp",value:function(t){var e,n,i,r,s,o;for(s=[],e=n=0,i=(r=this.set).length;n<i;e=++n)void 0!==(o=t(new y(r[e]),e))&&s.push(o);return s}},{key:"is",value:function(t){var e,n,i,r,s,o;for(e=["string","function"].indexOf(void 0===t?"undefined":_typeof(t)),i=r=0,s=(o=this.set).length;r<s;i=++r){if(n=o[i],!(0!==e||n.nodeType!==Node.TEXT_NODE&&n.matches(t)))return!1;if(1===e&&!t(new y(n),i))return!1}return!0}},{key:"classes",value:function(){var t,e,n,i,r,s,o,a,u;for(t=[],n=i=0,s=(u=this.set).length;i<s;n=++i)for(r=0,o=(a=u[n].className.split(/\s+/)).length;r<o;r++)e=a[r],d.call(t,e)<0&&t.push(e);return t}},{key:"focus",value:function(){return this.set[0].focus(),this}},{key:"value",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:f;return e===f?"checkbox"===this.set[0].type?this.set[0].checked:"file"===this.set[0].type?this.set[0].files:(e=this.set[0].value)?"number"===this.set[0].type?+e:e:null:(this.iter(function(t){return"select"===t.tag().toLowerCase()?t.children("option").attr("selected",function(t){return!!t.attr("value"===e)||null}):t.first(!1).value=e}),this)}},{key:"attr",value:function(n){var t,e,i,r,s=1<arguments.length&&void 0!==arguments[1]?arguments[1]:f;if("string"==typeof n){if(s===f)return this.set[0].getAttribute(n);for(e=0,i=(r=this.set).length;e<i;e++)t=r[e],null===s?t.removeAttribute(n):t.setAttribute(n,s);return this}if("object"===(void 0===n?"undefined":_typeof(n)))return this.iter(function(t){var e;for(e in n)s=n[e],t.attr(e,s)}),this;throw"Illegal argument: "+n}},{key:"css",value:function(t){var e,n,s=this,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:f;if(e=function(i,r){return i=i.replace(/-([a-z])/g,function(t){return t[1].toUpperCase()}),s.iter(function(t,e){var n;return"number"==typeof(n=y.tk.resolve(r,t,e))&&(n+="px"),t.set[0].style[i]=n})},"string"==typeof t){if(i===f)return window.getComputedStyle(this.set[0]).getPropertyValue(t);e(t,i)}else{if("object"!==(void 0===t?"undefined":_typeof(t)))throw"Illegal argument";for(n in t)e(n,i=t[n])}return this}},{key:"on",value:function(t){var e,n,i,r,s,o=this,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:f;if(e=function(r,s){return o.iter(function(e,n){var t,i;return(t=e.first(!1)).__listeners__||(t.__listeners__=[]),"function"==typeof r&&(r=r(e,n)),i={event:r,callback:function(t){return s(e,t,n)}},t.__listeners__.push(i),t.addEventListener(i.event,i.callback)})},"string"==typeof t)if(a===f){if(null==pure.__listeners__)return[];for(n=0,i=(s=pure.__listeners__).length;n<i;n++)return s[n].callback}else e(t,a);else{if("object"!==(void 0===t?"undefined":_typeof(t)))throw"Illegal argument";for(r in t)e(r,t[r])}return this}},{key:"off",value:function(i){var t,e,n,r,s,o,a,u;for(e=0,r=(a=this.set).length;e<r;e++){for(t=a[e],n=0,s=(o=null!=t.__listeners__||[]).length;n<s;n++)(u=o[n]).event===i&&t.removeEventListener(u.event,u.callback);t.__listeners__=function(){var t,e,n;for(n=[],t=0,e=o.length;t<e;t++)(u=o[t]).event!==i&&n.push(u);return n}()}return this}},{key:"classify",value:function(t){var h,e,n,i=this,r=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:f;if(h=function(a,u,l){return"toggle"===u&&(u=function(t,e){return d.call(t.classes(),a)<0}),i.iter(function(t,e){var n,i,r,s,o;if("function"==typeof(i=u)&&(i=i(t,e)),n=t.classes(),r=0<=d.call(n,a),i&&!r?n.push(a):!i&&r&&(s=n.indexOf(a),n.splice(s,1)),t.set[0].className=n.join(" ").trim(),l!==f)return"function"==typeof(o=l)&&(o=o(t,e)),y.tk.timeout(o,function(t){return h(a,!i,f)})})},"string"==typeof t)h(t,r,s);else for(n in t)e=t[n],h(n,e,f);return this}},{key:"remove",value:function(){var t,e,n,i;for(e=0,n=(i=this.set).length;e<n;e++)null!==(t=i[e]).parentNode&&t.parentNode.removeChild(t);return this}},{key:"append",value:function(t){var e,n,i,r;for((t=new y(t,this)).remove(),this.first().parents("body").empty||y.tk.guts.inspect(t),n=0,i=(r=t.set).length;n<i;n++)e=r[n],this.set[0].appendChild(e);return t}},{key:"prepend",value:function(t){var e,n,i;for((t=new y(t,this)).remove(),this.first().parents("body").empty||y.tk.guts.inspect(t),n=(i=t.set).length-1;0<=n;n+=-1)e=i[n],this.set[0].prepend(e);return t}},{key:"replace",value:function(t){var e;return this.first().parents("body").empty||((e=t)instanceof y||(e=new y(e,this)),y.tk.guts.inspect(e)),t instanceof y&&(t=t.first(!1)),this.set[0].parentNode.replaceChild(t,this.set[0]),new y(t,this.parent)}},{key:"tag",value:function(){return this.set[0].tagName}},{key:"next",value:function(){var t,e,n,i,r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:f;if(r===f)return this.empty?new y([]):new y(this.set[0].nextSibling,this);for(!r instanceof y&&(r=tk(r)),e=0,n=(i=r.set).length;e<n;e++)t=i[e],this.set[0].parentNode.insertBefore(t,this.set[0].nextSibling);return r.parent=this,r}},{key:"prev",value:function(){var t,e,n,i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:f;if(i===f)return this.empty?new y([]):new y(this.set[0].previousSibling,this);for(!i instanceof y&&(i=tk(i)),e=(n=i.set).length-1;0<=e;e+=-1)t=n[e],this.set[0].parentNode.insertBefore(t,this.set[0]);return i.parent=this,i}},{key:"html",value:function(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:f;return n===f?this.set[0].innerHTML:(this.iter(function(t,e){return t.set[0].innerHTML=y.tk.resolve(n,t,e)}),this)}},{key:"text",value:function(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:f;return n===f?this.set[0].textContent:(this.iter(function(t,e){return t.set[0].textContent=y.tk.resolve(n,t,e)}),this)}},{key:"select",value:function(){return this.set[0].select(),this}},{key:"offset",value:function(){var t,e,n=0<arguments.length&&void 0!==arguments[0]&&arguments[0];for(e={x:0,y:0},t=this.set[0];t&&(e.x+=t.offsetLeft,e.y+=t.offsetTop,!n);)t=t.offsetParent;return e}},{key:"size",value:function(){var t,e,n,i,r=0<arguments.length&&void 0!==arguments[0]&&arguments[0];return n={width:(t=(e=this.set[0]).getBoundingClientRect()).width,height:t.height},r&&(i=window.getComputedStyle(e,null),n.width+=i.getPropertyValue("margin-left"),n.width+=i.getPropertyValue("margin-right"),n.height+=i.getPropertyValue("margin-top"),n.height+=i.getPropertyValue("margin-bottom"),"border-box"===i.getPropertyValue("box-sizing")&&(n.width+=i.getPropertyValue("padding-left"),n.width+=i.getPropertyValue("padding-right"),n.height+=i.getPropertyValue("padding-top"),n.height+=i.getPropertyValue("padding-bottom"))),n}},{key:"data",value:function(){if(null!=this.set[0]._tkData)return this.set[0]._tkData;throw"No data."}},{key:"key",value:function(){if(null!=this.set[0]._tkKey)return this.set[0]._tkKey;throw"No key."}},{key:"index",value:function(){if(null!=this.set[0]._tkIndex)return this.set[0]._tkIndex;throw"No index."}}]),y}();return t.tk=null,t}.call(this),a.attach(function t(e){_classCallCheck(this,t),(e.ToolkitSelection=c).tk=e}),s=function(){function i(t,e){var n;_classCallCheck(this,i),this.object=t,this.property=e,this.object.__listeners__||(this.object.__listeners__={}),this.object.__listeners__[this.property]||(this.object.__listeners__[this.property]=[],n=this._descriptor(this.object[this.property],this.object.__listeners__[this.property]),Object.defineProperty(this.object,this.property,n)),this.object.__listeners__[this.property].push(this),this._changed=function(){},this._accessed=function(){}}return _createClass(i,[{key:"_descriptor",value:function(t,i){var r;return r=t,{get:function(){var t,e;for(t=0,e=i.length;t<e;t++)i[t]._accessed(r);return r},set:function(t){var e,n;if(r===t)return r;for(r=t,e=0,n=i.length;e<n;e++)i[e]._changed(t);return r}}}},{key:"changed",value:function(t){var e=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];return this._changed=t,e&&t(this.object[this.property]),this}},{key:"accessed",value:function(t){return this._accessed=t,this}},{key:"remove",value:function(){var t;return t=this.object.__listeners__[this.property].indexOf(this),this.object.__listeners__[this.property].splice(t,1),this}}]),i}(),r=function(){function e(t){_classCallCheck(this,e),this.array=t,this.array.__listeners__||this._mixinListeners(),this.array.__listeners__.push(this),this._added=function(){},this._removed=function(){},this._accessed=function(){}}return _createClass(e,[{key:"_mixinListeners",value:function(){var r,h,p,g,_,k=this;return g=this.array.__listeners__=[],_=function(){var t,e,n,i,r;for(r=[],e=n=0,i=k.array.length;0<=i?n<i:i<n;e=0<=i?++n:--n)t=k._indexDescriptor(k.array[e],e,g),r.push(Object.defineProperty(k.array,e+"",t));return r},h=this.array.push,this.array.push=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];var i,r,s,o,a,u,l;for(l=k.array.length,h.apply(k.array,e),_(),i=s=0,a=e.length;s<a;i=++s)for(r=e[i],o=0,u=g.length;o<u;o++)g[o]._added(r,l+i);return k.array.length},r=this.array.pop,this.array.pop=function(){var t,e,n,i;for(i=k.array[t=k.array.length-1],r.apply(k.array),_(),e=0,n=g.length;e<n;e++)g[e]._removed(i,t);return i},p=this.array.splice,this.array.splice=function(r,s){for(var t=arguments.length,e=Array(2<t?t-2:0),n=2;n<t;n++)e[n-2]=arguments[n];var o,i,a,u,l,h,c,f,d,y,v;for(y=function(){var t,e,n,i;for(i=[],o=t=e=r,n=r+s;e<=n?t<n:n<t;o=e<=n?++t:--t)i.push(this.array[o]);return i}.call(k),v=p.apply(k.array,[r,s].concat(e)),_(),o=i=0,f=s;0<=f?i<f:f<i;o=0<=f?++i:--i)for(a=0,l=g.length;a<l;a++)g[a]._removed(y[o],r+o);for(o=u=0,d=e.length;0<=d?u<d:d<u;o=0<=d?++u:--u)for(c=0,h=g.length;c<h;c++)g[c]._added(k.array[r+o],o);return v}}},{key:"_indexDescriptor",value:function(t,s,o){var a;return a=t,{get:function(){var i;return function(){var t,e,n;for(n=[],t=0,e=o.length;t<e;t++)i=o[t],n.push(i._accessed(a))}(),a},set:function(t){var e,n,i,r;if(a===t)return a;for(a=t,e=0,i=o.length;e<i;e++)o[e]._removed(a,s);for(n=0,r=o.length;n<r;n++)o[n]._added(t,s);return a},configurable:!0}}},{key:"added",value:function(t){var e,n,i,r;for(this._added=t,e=n=0,i=(r=this.array).length;n<i;e=++n)t(r[e],e);return this}},{key:"removed",value:function(t){return this._removed=t,this}},{key:"accessed",value:function(t){return this._accessed=t,this}}]),e}(),a.attach(o(function(){function t(){_classCallCheck(this,t),this.called="listener"}return _createClass(t,[{key:"_call",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:f;if(t instanceof Array)return new r(t);if("object"===(void 0===t?"undefined":_typeof(t)))return new s(t,e);throw"Invalid parameter"}}]),t}())),e=function(){function n(t,e){_classCallCheck(this,n),this.tk=t,this.definition=e,this._data=null}return _createClass(n,[{key:"data",value:function(){return this._data=arguments,this}},{key:"_safeAppend",value:function(t,e){var n,i,r,s;if(e instanceof Array){for(s=[],i=0,r=e.length;i<r;i++)n=e[i],s.push(t.appendChild(n));return s}return t.appendChild(e)}},{key:"_realize",value:function(i){var t,r,e,n,s,o,a,u,l;if(!i)return document.createTextNode("");if("string"==typeof i||"number"==typeof i)u=document.createTextNode(i);else if("function"==typeof i)u=this._realize(i());else if(i instanceof Array)u=function(){var t,e,n;for(n=[],t=0,e=i.length;t<e;t++)r=i[t],n.push(this._realize(r));return n}.call(this);else{for(s in u=document.createElement(i.tag),o=i.attributes)l=o[s],u.setAttribute(s,l);for(null!=i._dataK&&this.tk.iter(this.tk._dataStore[i._dataK],function(t,e){return u[t]=e}),e=0,n=(a=i.children).length;e<n;e++)t=a[e],this._safeAppend(u,this._realize(t))}return u}},{key:"render",value:function(){return this.tk(this._realize(this.definition.apply(null,this._data)))}}]),n}(),a.attach(o(function(){function t(){_classCallCheck(this,t),this.called="template"}return _createClass(t,[{key:"_call",value:function(t){return new e(this,t)}},{key:"tag",value:function(t,e){for(var n=arguments.length,i=Array(2<n?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return{tag:t,attributes:e||{},children:i,__tkVirtual__:!0}}}]),t}())),i=o(function(){function e(){var t;_classCallCheck(this,e),this.initialized=!1,t=!0,Object.defineProperty(this,"here",{get:function(){if(!t)return console.log("here"),"here";t=!1}}),this._dataK=0,this._dataStore={}}return _createClass(e,[{key:"_call",value:function(t){return new c(t)}},{key:"_finalize",value:function(t){var e,n,i,r,s=this;this.config={root:null!=(e=t.root)?e:"undefined"!=typeof document&&null!==document?document:null,debug:null!=(n=t.debug)&&n,iteration:{ignoreKeys:["__listeners__"].concat(null!=(i=null!=(r=t.iteration)?r.ignoreKeys:void 0)?i:[])}},this.guts=a.onto(this),/complete|loaded|interactive/.test("undefined"!=typeof document&&null!==document?document.readyState:void 0)?(this.initialized=!0,this.guts.init()):"undefined"!=typeof window&&null!==window&&window.addEventListener("DOMContentLoaded",function(){return s.initialized=!0,s.guts.init()})}},{key:"init",value:function(t){return this.initialized&&t(),this.guts.initFunctions.push(t),this}},{key:"inspection",value:function(t){return this.guts.inspectionFunctions.push(t),this}},{key:"log",value:function(){for(var t,e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];return(null!=(t=this.config)?t.debug:void 0)&&console.log.apply(null,n),n[0]}},{key:"warn",value:function(){for(var t,e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];return(null!=(t=this.config)?t.debug:void 0)&&console.warn.apply(null,n),n[0]}},{key:"resolve",value:function(t){if("function"!=typeof t)return t;for(var e=arguments.length,n=Array(1<e?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return t.apply(null,n)}},{key:"time",value:function(){return(new Date).getTime()}},{key:"range",value:function(t){var e,n,i,r,s,o,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;for(i=0,a&&(i=t,t=a),o=[],e=n=r=i,s=t;r<=s?n<s:s<n;e=r<=s?++n:--n)o.push(e);return o}},{key:"iter",value:function(t,e){var n,i,r,s,o;if(t instanceof Array)for(n=i=0,r=t.length;i<r&&!1!==e(t[n],n);n=++i);else{if("object"!==(void 0===t?"undefined":_typeof(t)))throw"Not iterable: "+t;for(s in t)if(o=t[s],!(0<=d.call(this.config.iteration.ignoreKeys,s))&&!1===e(s,o))break}}},{key:"_markData",value:function(t,e){return this._dataStore[this._dataK+""]=e,t._dataK=this._dataK,this._dataK++,t}},{key:"comp",value:function(t,e){var n,i,r,s,o,a,u,l;if(a=[],t instanceof Array)for(n=r=0,s=t.length;r<s;n=++r)null!=(u=e(i=t[n],n))&&(null!=u.__tkVirtual__?a.push(this._markData(u,{_tkData:i,_tkIndex:n})):a.push(u));else{if("object"!==(void 0===t?"undefined":_typeof(t)))throw"Not iterable: "+t;for(o in t)l=t[o],0<=d.call(this.config.iteration.ignoreKeys,o)||null!=(u=e(o,l))&&(null!=u.__tkVirtual__?a.push(this._markData(u,{_tkData:l,_tkKey:o})):a.push(u))}return a}},{key:"timeout",value:function(t,e){var n;return n=setTimeout(e,t),{cancel:function(){return clearTimeout(n)}}}},{key:"transition",value:function(e){var t,n,i,r;return requestAnimationFrame?(n=null,r=function(t){if(null===n?(n=t,t=0):t-=n,!1!==e(t))return requestAnimationFrame(r)},requestAnimationFrame(r)):(i=0,t=timeout(16,function(){return!1===e(i)&&t.cancel(),i+=16}))}},{key:"tag",value:function(t){var e,n,i,r,s,o,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};for(r in n=document.createElement(t),a)o=a[r],n.setAttribute(r,o);for(var u=arguments.length,l=Array(2<u?u-2:0),h=2;h<u;h++)l[h-2]=arguments[h];for(i=0,s=l.length;i<s;i++)"string"==typeof(e=l[i])?n.appendChild(document.createTextNode(e)):n.appendChild(this.tag(e));return new c(n)}}]),e}()),u={create:function(){var t,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return(t=new i)._finalize(e),t}},"undefined"!=typeof window&&null!==window?window.toolkit=u:module.exports=u}).call(void 0);