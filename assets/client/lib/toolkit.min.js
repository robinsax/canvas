/*
toolkit.js

Author: Robin Saxifrage
License: Apache 2.0
*/
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(function(){var n,i,r,e,o,h,t,f,s,u,a,d=[].indexOf;f={},s=function(u){return function(){var e,i,t,n,r,o,s;for(e=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return i._call.apply(this,t)},s=i=new u;;){for(t=0,n=(o=Object.getOwnPropertyNames(s)).length;t<n;t++)"function"==typeof s[r=o[t]]?e[r]=s[r]:Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r));if(!(s=Object.getPrototypeOf(s)))break}return e}},e=function(){function e(){_classCallCheck(this,e),this.initFunctions=[],this.inspectionFunctions=[],this.modules=[]}return _createClass(e,[{key:"attach",value:function(e){return this.modules.push(e),this}},{key:"onto",value:function(e){var t,n,i,r;for(n=0,i=(r=this.modules).length;n<i;n++)(t=new(0,r[n])(e)).called&&(e[t.called]=t);return this}},{key:"init",value:function(){var e,t,n;for(e=0,t=(n=this.initFunctions).length;e<t;e++)(0,n[e])();return this}},{key:"inspect",value:function(e){var t,n,i;if(0<this.inspectionFunctions.length)for(e=e.extend(e.children()),t=0,n=(i=this.inspectionFunctions).length;t<n;t++)(0,i[t])(e);return this}}]),e}(),u=new e,n=function(){function i(e,t,n){_classCallCheck(this,i),this.tk=e,this.info={method:t,url:n,success:function(){return{}},failure:function(){return{}},query:{},headers:{},body:null}}return _createClass(i,[{key:"success",value:function(e){return this.info.success=e,this}},{key:"failure",value:function(e){return this.info.failure=e,this}},{key:"json",value:function(e){return this.info.headers["Content-Type"]="application/json",this.info.body=this.tk.unbound(e),this}},{key:"data",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"text/plain";return this.info.headers["Content-Type"]=t,this.info.body=e,this}},{key:"header",value:function(e,t){return this.info.headers[e]=t,this}},{key:"query",value:function(e){return this.info.query=e,this}},{key:"send",value:function(){var e,i,t,n,r,o,s,u,a,l=this;if(n=function(e){var t,n,i;switch(i=e.status,n=e.getResponseHeader("Content-Type"),t=e.responseText,n){case"application/json":t=JSON.parse(t)}return l.tk.log("Received "+i+" ("+l.info.method+", "+l.info.url+")"),(i<400?l.info.success:l.info.failure)(t,i)},e=this.info.url,s="",0<(r=Object.getOwnPropertyNames(this.info.query)).length&&(e+="?"+function(){var e,t,n;for(n=[],e=0,t=r.length;e<t;e++)i=r[e],n.push(i+"="+encodeURIComponent(this.info.query[i]));return n}.call(this).join("&")),this.info.body)switch(t=this.info.headers["Content-Type"]){case"application/json":s=JSON.stringify(this.info.body);break;default:throw"Unknown outgoing mimetype "+t}for(i in(a=new XMLHttpRequest).onreadystatechange=function(){if(4===this.readyState)return n(this)},a.open(this.info.method,e,!0),o=this.info.headers)u=o[i],a.setRequestHeader(i,u);return a.send(s),this.tk.log("Sent ("+this.info.method+", "+this.info.url+")",this.info.body)}}]),i}(),u.attach(s(function(){function t(e){_classCallCheck(this,t),this.tk=e,this.called="request"}return _createClass(t,[{key:"_call",value:function(e,t){return new n(this,e,t)}}]),t}())),h=function(){var e=function(){function y(e,t){var n,i,r;if(_classCallCheck(this,y),this.parent=t,e instanceof y)this.set=e.set.slice();else if(e instanceof Element||e instanceof Node||e instanceof Window)this.set=[e];else if(e instanceof NodeList||e instanceof Array)for(this.set=[],i=0,r=e.length;i<r;i++)n=e[i],this.set=this.set.concat(y.clean(n));else{if("string"!=typeof e)throw"Illegal selection: "+e;this.set=y.tk.config.root.querySelectorAll(e)}this.length=this.set.length,this.empty=0===this.length}return _createClass(y,null,[{key:"clean",value:function(e){var t,n,i,r;if(e instanceof Node)return[e];for(e instanceof y&&(e=e.set),t=[],i=0,r=e.length;i<r;i++)(n=e[i])instanceof y?t=t.concat(n.set):t.push(n);return t}}]),_createClass(y,[{key:"back",value:function(){if(!this.parent)throw"Illegal back";return this.parent}},{key:"ith",value:function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];if(e<0||e>this.length)throw"Out of bounds: "+e;return t?new y(this.set[e],this):this.set[e]}},{key:"first",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];return this.ith(0,e)}},{key:"reversed",value:function(){var e;return(e=this.set.slice()).reverse(),new y(e,this)}},{key:"reduce",value:function(t){var e;switch(void 0===t?"undefined":_typeof(t)){case"string":e=this.comp(function(e){if(e.is(t))return e});break;case"function":e=this.comp(t);break;default:throw"Illegal reducer"}return new y(e,this)}},{key:"extend",value:function(e){var t;if(e instanceof y)t=e.set;else{if(!(e instanceof Array||e instanceof NodeList))throw"Illegal extension";t=y.clean(e)}return new y(this.set.concat(t,this))}},{key:"parents",value:function(){var i,n,r,o=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"*",s=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];if((n=["string","function","boolean"].indexOf(void 0===o?"undefined":_typeof(o)))<0)throw"Illegal condition";return 2===n&&(n=0,o="*",s=!1),i=function(e,t){return 0===n?e.is(o):o(e,t)},r=[],this.iter(function(e,t){var n;for(n=e.first(!1).parentNode;n!==y.tk.config.root&&null!==n;){if(i(tk(n,t))&&r.push(n),!s)return;n=n.parentNode}}),new y(r,this)}},{key:"children",value:function(){var c,h,f=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"*",d=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];if((c=["string","function"].indexOf(void 0===f?"undefined":_typeof(f)))<0)throw"Illegal condition";return h=[],this.iter(function(e,t){var n,i,r,o,s,u,a,l;if((e=e.first(!1)).nodeType!==Node.TEXT_NODE){if(l=[],0===c)if(d)l=e.querySelectorAll(f);else for(r=0,s=(a=e.children).length;r<s;r++)(i=a[r]).matches(f)&&(l=i);else for(new y(n=d?e.querySelectorAll("*"):e.children),o=0,u=n.length;o<u;o++)i=n[o],f(wrap,t)&&(l=i);return h=h.concat(l)}}),new y(h,this)}},{key:"copy",value:function(){var e;return e=this.set[0].cloneNode(!0),new y(e,this)}},{key:"iter",value:function(e){var t,n,i,r;for(t=n=0,i=(r=this.set).length;n<i&&!1!==e(new y(r[t]),t);t=++n);return this}},{key:"comp",value:function(e){var t,n,i,r,o,s;for(o=[],t=n=0,i=(r=this.set).length;n<i;t=++n)void 0!==(s=e(new y(r[t]),t))&&o.push(s);return o}},{key:"is",value:function(e){var t,n,i,r,o,s;for(t=["string","function"].indexOf(void 0===e?"undefined":_typeof(e)),i=r=0,o=(s=this.set).length;r<o;i=++r){if(n=s[i],!(0!==t||n.nodeType!==Node.TEXT_NODE&&n.matches(e)))return!1;if(1===t&&!e(new y(n),i))return!1}return!0}},{key:"classes",value:function(){var e,t,n,i,r,o,s,u,a;for(e=[],n=i=0,o=(a=this.set).length;i<o;n=++i)for(r=0,s=(u=a[n].className.split(/\s+/)).length;r<s;r++)t=u[r],d.call(e,t)<0&&e.push(t);return e}},{key:"focus",value:function(){return this.set[0].focus(),this}},{key:"value",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:f;return t===f?"checkbox"===this.set[0].type?this.set[0].checked:(t=this.set[0].value)?"number"===this.set[0].type?+t:t:null:(this.iter(function(e){return"select"===e.tag().toLowerCase()?e.children("option").attr("selected",function(e){return!!e.attr("value"===t)||null}):e.first(!1).value=t}),this)}},{key:"attr",value:function(n){var e,t,i,r,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:f;if("string"==typeof n){if(o===f)return this.set[0].getAttribute(n);for(t=0,i=(r=this.set).length;t<i;t++)e=r[t],null===o?e.removeAttribute(n):e.setAttribute(n,o);return this}if("object"===(void 0===n?"undefined":_typeof(n)))return this.iter(function(e){var t;for(t in n)o=n[t],e.attr(t,o)}),this;throw"Illegal argument: "+n}},{key:"css",value:function(e){var t,n,o=this,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:f;if(t=function(i,r){return i=i.replace(/-([a-z])/g,function(e){return e[1].toUpperCase()}),o.iter(function(e,t){var n;return"number"==typeof(n=y.tk.resolve(r,e,t))&&(n+="px"),e.set[0].style[i]=n})},"string"==typeof e){if(i===f)return window.getComputedStyle(this.set[0]).getPropertyValue(e);t(e,i)}else{if("object"!==(void 0===e?"undefined":_typeof(e)))throw"Illegal argument";for(n in e)t(n,i=e[n])}return this}},{key:"on",value:function(e){var t,n,i,r,o,s=this,u=1<arguments.length&&void 0!==arguments[1]?arguments[1]:f;if(t=function(r,o){return s.iter(function(t,n){var e,i;return(e=t.first(!1)).__listeners__||(e.__listeners__=[]),"function"==typeof r&&(r=r(t,n)),i={event:r,callback:function(e){return o(t,e,n)}},e.__listeners__.push(i),e.addEventListener(i.event,i.callback)})},"string"==typeof e)if(u===f){if(null==pure.__listeners__)return[];for(n=0,i=(o=pure.__listeners__).length;n<i;n++)return o[n].callback}else t(e,u);else{if("object"!==(void 0===e?"undefined":_typeof(e)))throw"Illegal argument";for(r in e)t(r,e[r])}return this}},{key:"off",value:function(i){var e,t,n,r,o,s,u,a;for(t=0,r=(u=this.set).length;t<r;t++){for(e=u[t],n=0,o=(s=null!=e.__listeners__||[]).length;n<o;n++)(a=s[n]).event===i&&e.removeEventListener(a.event,a.callback);e.__listeners__=function(){var e,t,n;for(n=[],e=0,t=s.length;e<t;e++)(a=s[e]).event!==i&&n.push(a);return n}()}return this}},{key:"classify",value:function(e){var c,t,n,i=this,r=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:f;if(c=function(u,a,l){return"toggle"===a&&(a=function(e,t){return d.call(e.classes(),u)<0}),i.iter(function(e,t){var n,i,r,o,s;if("function"==typeof(i=a)&&(i=i(e,t)),n=e.classes(),r=0<=d.call(n,u),i&&!r?n.push(u):!i&&r&&(o=n.indexOf(u),n.splice(o,1)),e.set[0].className=n.join(" ").trim(),l!==f)return"function"==typeof(s=l)&&(s=s(e,t)),y.tk.timeout(s,function(e){return c(u,!i,f)})})},"string"==typeof e)c(e,r,o);else for(n in e)t=e[n],c(n,t,f);return this}},{key:"remove",value:function(){var e,t,n,i;for(t=0,n=(i=this.set).length;t<n;t++)null!==(e=i[t]).parentNode&&e.parentNode.removeChild(e);return this}},{key:"append",value:function(e){var t,n,i,r;for((e=new y(e,this)).remove(),this.first().parents("body").empty||y.tk.guts.inspect(e),n=0,i=(r=e.set).length;n<i;n++)t=r[n],this.set[0].appendChild(t);return e}},{key:"prepend",value:function(e){var t,n,i;for((e=new y(e,this)).remove(),this.first().parents("body").empty||y.tk.guts.inspect(e),n=(i=e.set).length-1;0<=n;n+=-1)t=i[n],this.set[0].prepend(t);return e}},{key:"replace",value:function(e){var t;return this.first().parents("body").empty||((t=e)instanceof y||(t=new y(t,this)),y.tk.guts.inspect(t)),e instanceof y&&(e=e.first(!1)),this.set[0].parentNode.replaceChild(e,this.set[0]),new y(e,this.parent)}},{key:"tag",value:function(){return this.set[0].tagName}},{key:"next",value:function(){var e,t,n,i,r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:f;if(r===f)return this.empty?new y([]):new y(this.set[0].nextSibling,this);for(!r instanceof y&&(r=tk(r)),t=0,n=(i=r.set).length;t<n;t++)e=i[t],this.set[0].parentNode.insertBefore(e,this.set[0].nextSibling);return r.parent=this,r}},{key:"prev",value:function(){var e,t,n,i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:f;if(i===f)return this.empty?new y([]):new y(this.set[0].previousSibling,this);for(!i instanceof y&&(i=tk(i)),t=(n=i.set).length-1;0<=t;t+=-1)e=n[t],this.set[0].parentNode.insertBefore(e,this.set[0]);return i.parent=this,i}},{key:"html",value:function(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:f;return n===f?this.set[0].innerHTML:(this.iter(function(e,t){return e.set[0].innerHTML=y.tk.resolve(n,e,t)}),this)}},{key:"text",value:function(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:f;return n===f?this.set[0].textContent:(this.iter(function(e,t){return e.set[0].textContent=y.tk.resolve(n,e,t)}),this)}},{key:"select",value:function(){return this.set[0].select(),this}},{key:"offset",value:function(){var e,t,n=0<arguments.length&&void 0!==arguments[0]&&arguments[0];for(t={x:0,y:0},e=this.set[0];e&&(t.x+=e.offsetLeft,t.y+=e.offsetTop,!n);)e=e.offsetParent;return t}},{key:"size",value:function(){var e,t,n,i,r=0<arguments.length&&void 0!==arguments[0]&&arguments[0];return n={width:(e=(t=this.set[0]).getBoundingClientRect()).width,height:e.height},r&&(i=window.getComputedStyle(t,null),n.width+=i.getPropertyValue("margin-left"),n.width+=i.getPropertyValue("margin-right"),n.height+=i.getPropertyValue("margin-top"),n.height+=i.getPropertyValue("margin-bottom"),"border-box"===i.getPropertyValue("box-sizing")&&(n.width+=i.getPropertyValue("padding-left"),n.width+=i.getPropertyValue("padding-right"),n.height+=i.getPropertyValue("padding-top"),n.height+=i.getPropertyValue("padding-bottom"))),n}}]),y}();return e.tk=null,e}.call(this),u.attach(function e(t){_classCallCheck(this,e),(t.ToolkitSelection=h).tk=t}),o=function(){function i(e,t){var n;_classCallCheck(this,i),this.object=e,this.property=t,this.object.__listeners__||(this.object.__listeners__={}),this.object.__listeners__[this.property]||(this.object.__listeners__[this.property]=[],n=this._descriptor(this.object[this.property],this.object.__listeners__[this.property]),Object.defineProperty(this.object,this.property,n)),this.object.__listeners__[this.property].push(this),this._changed=function(){},this._accessed=function(){}}return _createClass(i,[{key:"_descriptor",value:function(e,i){var r;return r=e,{get:function(){var e,t;for(e=0,t=i.length;e<t;e++)i[e]._accessed(r);return r},set:function(e){var t,n;if(r===e)return r;for(r=e,t=0,n=i.length;t<n;t++)i[t]._changed(e);return r}}}},{key:"changed",value:function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];return this._changed=e,t&&e(this.object[this.property]),this}},{key:"accessed",value:function(e){return this._accessed=e,this}},{key:"remove",value:function(){var e;return e=this.object.__listeners__[this.property].indexOf(this),this.object.__listeners__[this.property].splice(e,1),this}}]),i}(),r=function(){function t(e){_classCallCheck(this,t),this.array=e,this.array.__listeners__||this._mixinListeners(),this.array.__listeners__.push(this),this._added=function(){},this._removed=function(){},this._accessed=function(){}}return _createClass(t,[{key:"_mixinListeners",value:function(){var r,c,p,g,_,k=this;return g=this.array.__listeners__=[],_=function(){var e,t,n,i,r;for(r=[],t=n=0,i=k.array.length;0<=i?n<i:i<n;t=0<=i?++n:--n)e=k._indexDescriptor(k.array[t],t,g),r.push(Object.defineProperty(k.array,t+"",e));return r},c=this.array.push,this.array.push=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var i,r,o,s,u,a,l;for(l=k.array.length,c.apply(k.array,t),_(),i=o=0,u=t.length;o<u;i=++o)for(r=t[i],s=0,a=g.length;s<a;s++)g[s]._added(r,l+i);return k.array.length},r=this.array.pop,this.array.pop=function(){var e,t,n,i;for(i=k.array[e=k.array.length-1],r.apply(k.array),_(),t=0,n=g.length;t<n;t++)g[t]._removed(i,e);return i},p=this.array.splice,this.array.splice=function(r,o){for(var e=arguments.length,t=Array(2<e?e-2:0),n=2;n<e;n++)t[n-2]=arguments[n];var s,i,u,a,l,c,h,f,d,y,v;for(y=function(){var e,t,n,i;for(i=[],s=e=t=r,n=r+o;t<=n?e<n:n<e;s=t<=n?++e:--e)i.push(this.array[s]);return i}.call(k),v=p.apply(k.array,[r,o].concat(t)),_(),s=i=0,f=o;0<=f?i<f:f<i;s=0<=f?++i:--i)for(u=0,l=g.length;u<l;u++)g[u]._removed(y[s],r+s);for(s=a=0,d=t.length;0<=d?a<d:d<a;s=0<=d?++a:--a)for(h=0,c=g.length;h<c;h++)g[h]._added(k.array[r+s],s);return v}}},{key:"_indexDescriptor",value:function(e,o,s){var u;return u=e,{get:function(){var i;return function(){var e,t,n;for(n=[],e=0,t=s.length;e<t;e++)i=s[e],n.push(i._accessed(u))}(),u},set:function(e){var t,n,i,r;if(u===e)return u;for(u=e,t=0,i=s.length;t<i;t++)s[t]._removed(u,o);for(n=0,r=s.length;n<r;n++)s[n]._added(e,o);return u},configurable:!0}}},{key:"added",value:function(e){var t,n,i,r;for(this._added=e,t=n=0,i=(r=this.array).length;n<i;t=++n)e(r[t],t);return this}},{key:"removed",value:function(e){return this._removed=e,this}},{key:"accessed",value:function(e){return this._accessed=e,this}}]),t}(),u.attach(s(function(){function e(){_classCallCheck(this,e),this.called="listener"}return _createClass(e,[{key:"_call",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:f;if(e instanceof Array)return new r(e);if("object"===(void 0===e?"undefined":_typeof(e)))return new o(e,t);throw"Invalid parameter"}}]),e}())),t=function(){function n(e,t){_classCallCheck(this,n),this.tk=e,this.definition=t,this._data=null}return _createClass(n,[{key:"data",value:function(){return this._data=arguments,this}},{key:"_safeAppend",value:function(e,t){var n,i,r,o;if(t instanceof Array){for(o=[],i=0,r=t.length;i<r;i++)n=t[i],o.push(e.appendChild(n));return o}return e.appendChild(t)}},{key:"_realize",value:function(i){var e,r,t,n,o,s,u,a,l;if(!i)return document.createTextNode("");if("string"==typeof i||"number"==typeof i)a=document.createTextNode(i);else if("function"==typeof i)a=this._realize(i());else if(i instanceof Array)a=function(){var e,t,n;for(n=[],e=0,t=i.length;e<t;e++)r=i[e],n.push(this._realize(r));return n}.call(this);else{for(o in a=document.createElement(i.tag),s=i.attributes)l=s[o],a.setAttribute(o,l);for(t=0,n=(u=i.children).length;t<n;t++)e=u[t],this._safeAppend(a,this._realize(e))}return a}},{key:"render",value:function(){return this.tk(this._realize(this.definition.apply(null,this._data)))}}]),n}(),u.attach(s(function(){function e(){_classCallCheck(this,e),this.called="template"}return _createClass(e,[{key:"_call",value:function(e){return new t(this,e)}},{key:"tag",value:function(e,t){for(var n=arguments.length,i=Array(2<n?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return{tag:e,attributes:t||{},children:i,_virtual:!0}}}]),e}())),i=s(function(){function t(){var e;_classCallCheck(this,t),this.initialized=!1,e=!0,Object.defineProperty(this,"here",{get:function(){if(!e)return console.log("here"),"here";e=!1}})}return _createClass(t,[{key:"_call",value:function(e){return new h(e)}},{key:"_finalize",value:function(e){var t,n,i,r,o=this;this.config={root:null!=(t=e.root)?t:"undefined"!=typeof document&&null!==document?document:null,debug:null!=(n=e.debug)&&n,iteration:{ignoreKeys:["__listeners__"].concat(null!=(i=null!=(r=e.iteration)?r.ignoreKeys:void 0)?i:[])}},this.guts=u.onto(this),/complete|loaded|interactive/.test("undefined"!=typeof document&&null!==document?document.readyState:void 0)?(this.initialized=!0,this.guts.init()):"undefined"!=typeof window&&null!==window&&window.addEventListener("DOMContentLoaded",function(){return o.initialized=!0,o.guts.init()})}},{key:"init",value:function(e){return this.initialized&&e(),this.guts.initFunctions.push(e),this}},{key:"inspection",value:function(e){return this.guts.inspectionFunctions.push(e),this}},{key:"log",value:function(){for(var e,t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];return(null!=(e=this.config)?e.debug:void 0)&&console.log.apply(null,n),n[0]}},{key:"warn",value:function(){for(var e,t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];return(null!=(e=this.config)?e.debug:void 0)&&console.warn.apply(null,n),n[0]}},{key:"resolve",value:function(e){if("function"!=typeof e)return e;for(var t=arguments.length,n=Array(1<t?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return e.apply(null,n)}},{key:"time",value:function(){return(new Date).getTime()}},{key:"range",value:function(e){var t,n,i,r,o,s,u=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;for(i=0,u&&(i=e,e=u),s=[],t=n=r=i,o=e;r<=o?n<o:o<n;t=r<=o?++n:--n)s.push(t);return s}},{key:"iter",value:function(e,t){var n,i,r,o,s;if(e instanceof Array)for(n=i=0,r=e.length;i<r&&!1!==t(e[n],n);n=++i);else{if("object"!==(void 0===e?"undefined":_typeof(e)))throw"Not iterable: "+e;for(o in e)if(s=e[o],!(0<=d.call(this.config.iteration.ignoreKeys,o))&&!1===t(o,s))break}}},{key:"comp",value:function(e,t){var n,i,r,o,s,u,a;if(s=[],e instanceof Array)for(n=i=0,r=e.length;i<r;n=++i)null!=(u=t(e[n],n))&&s.push(u);else{if("object"!==(void 0===e?"undefined":_typeof(e)))throw"Not iterable: "+e;for(o in e)a=e[o],0<=d.call(this.config.iteration.ignoreKeys,o)||null!=(u=t(o,a))&&s.push(u)}return s}},{key:"timeout",value:function(e,t){var n;return n=setTimeout(t,e),{cancel:function(){return clearTimeout(n)}}}},{key:"transition",value:function(t){var e,n,i,r;return requestAnimationFrame?(n=null,r=function(e){if(null===n?(n=e,e=0):e-=n,!1!==t(e))return requestAnimationFrame(r)},requestAnimationFrame(r)):(i=0,e=timeout(16,function(){return!1===t(i)&&e.cancel(),i+=16}))}},{key:"tag",value:function(e){var t,n,i,r,o,s,u=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};for(r in n=document.createElement(e),u)s=u[r],n.setAttribute(r,s);for(var a=arguments.length,l=Array(2<a?a-2:0),c=2;c<a;c++)l[c-2]=arguments[c];for(i=0,o=l.length;i<o;i++)"string"==typeof(t=l[i])?n.appendChild(document.createTextNode(t)):n.appendChild(this.tag(t));return new h(n)}}]),t}()),a={create:function(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return(e=new i)._finalize(t),e}},"undefined"!=typeof window&&null!==window?window.toolkit=a:module.exports=a}).call(void 0);